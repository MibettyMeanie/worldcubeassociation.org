{"ast":null,"code":"import _isEqual from \"lodash/isEqual\";\nvar _jsxFileName = \"/app/WcaOnRails/app/webpacker/components/RolesTab/RoleForm.jsx\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nimport React from 'react';\nimport { Form, Grid } from 'semantic-ui-react';\nimport useLoadedData from \"../../lib/hooks/useLoadedData\";\nimport { roleDataUrl, roleUpdateUrl, apiV0Urls } from \"../../lib/requests/routes.js.erb\";\nimport { groupTypes } from \"../../lib/wca-data.js.erb\";\nimport useSaveAction from \"../../lib/hooks/useSaveAction\";\nimport Errored from \"../Requests/Errored\";\nimport DelegateForm from \"./DelegateForm\";\nimport Loading from \"../Requests/Loading\";\nvar groups = [{\n  key: 'delegates',\n  text: 'Delegates',\n  value: 'Delegates'\n}];\nvar delegateStatusOptions = ['trainee_delegate', 'candidate_delegate', 'delegate'];\nexport default function RoleForm(_ref) {\n  var userId = _ref.userId,\n    isActiveRole = _ref.isActiveRole;\n  var _useLoadedData = useLoadedData(roleDataUrl(userId, isActiveRole)),\n    data = _useLoadedData.data,\n    loading = _useLoadedData.loading,\n    error = _useLoadedData.error;\n  var _useLoadedData2 = useLoadedData(apiV0Urls.userGroups.list(groupTypes.delegate_regions)),\n    delegateRegions = _useLoadedData2.data,\n    regionsLoading = _useLoadedData2.loading,\n    regionsError = _useLoadedData2.error;\n  var _useSaveAction = useSaveAction(),\n    save = _useSaveAction.save,\n    saving = _useSaveAction.saving;\n  var selectedGroup = groups[0].value;\n  var _React$useState = React.useState({}),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    formValues = _React$useState2[0],\n    setFormValues = _React$useState2[1];\n  var _React$useState3 = React.useState(false),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    apiError = _React$useState4[0],\n    setError = _React$useState4[1];\n  var _React$useState5 = React.useState(false),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    finished = _React$useState6[0],\n    setFinished = _React$useState6[1];\n  React.useEffect(function () {\n    setFormValues(_objectSpread({\n      delegateStatus: delegateStatusOptions[0],\n      location: ''\n    }, (data === null || data === void 0 ? void 0 : data.roleData) || {}));\n  }, [data]);\n  var updateRole = function updateRole() {\n    save(roleUpdateUrl, _objectSpread({\n      userId: userId\n    }, formValues), function () {\n      return setFinished(true);\n    }, {\n      method: 'PATCH'\n    }, function () {\n      return setError(true);\n    });\n  };\n  var endRole = function endRole() {\n    save(roleUpdateUrl, {\n      userId: userId\n    }, function () {\n      return setFinished(true);\n    }, {\n      method: 'DELETE'\n    }, function () {\n      return setError(true);\n    });\n  };\n  if (loading || regionsLoading || !formValues) return /*#__PURE__*/React.createElement(Loading, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 56\n    }\n  });\n  if (error || apiError || regionsError) return /*#__PURE__*/React.createElement(Errored, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 49\n    }\n  });\n  if (finished) return 'Success...';\n  return /*#__PURE__*/React.createElement(Form, {\n    onSubmit: updateRole,\n    loading: saving,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Form.Dropdown, {\n    label: \"Group\",\n    fluid: true,\n    selection: true,\n    value: selectedGroup,\n    options: groups,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }\n  }), selectedGroup === groups[0].value // Delegates is selected\n  && /*#__PURE__*/React.createElement(DelegateForm, {\n    formValues: formValues,\n    updateFormProperty: function updateFormProperty(values) {\n      setFormValues(_objectSpread(_objectSpread({}, formValues), values));\n    },\n    delegateRegions: delegateRegions,\n    delegateStatusOptions: delegateStatusOptions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Grid, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Form.Button, {\n    primary: true,\n    type: \"submit\",\n    disabled: _isEqual(formValues, data === null || data === void 0 ? void 0 : data.roleData),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }\n  }, isActiveRole ? 'Update Role' : 'Create Role'), /*#__PURE__*/React.createElement(Form.Button, {\n    secondary: true,\n    type: \"button\",\n    onClick: endRole,\n    disabled: !isActiveRole,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }\n  }, \"End Role\")));\n}","map":{"version":3,"names":["React","Form","Grid","useLoadedData","roleDataUrl","roleUpdateUrl","apiV0Urls","groupTypes","useSaveAction","Errored","DelegateForm","Loading","groups","key","text","value","delegateStatusOptions","RoleForm","_ref","userId","isActiveRole","_useLoadedData","data","loading","error","_useLoadedData2","userGroups","list","delegate_regions","delegateRegions","regionsLoading","regionsError","_useSaveAction","save","saving","selectedGroup","_React$useState","useState","_React$useState2","_slicedToArray","formValues","setFormValues","_React$useState3","_React$useState4","apiError","setError","_React$useState5","_React$useState6","finished","setFinished","useEffect","_objectSpread","delegateStatus","location","roleData","updateRole","method","endRole","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","Dropdown","label","fluid","selection","options","updateFormProperty","values","Button","primary","type","disabled","_isEqual","secondary","onClick"],"sources":["/app/WcaOnRails/app/webpacker/components/RolesTab/RoleForm.jsx"],"sourcesContent":["import React from 'react';\n\nimport { Form, Grid } from 'semantic-ui-react';\n\nimport _ from 'lodash';\nimport useLoadedData from '../../lib/hooks/useLoadedData';\nimport {\n  roleDataUrl,\n  roleUpdateUrl,\n  apiV0Urls,\n} from '../../lib/requests/routes.js.erb';\nimport { groupTypes } from '../../lib/wca-data.js.erb';\nimport useSaveAction from '../../lib/hooks/useSaveAction';\nimport Errored from '../Requests/Errored';\nimport DelegateForm from './DelegateForm';\nimport Loading from '../Requests/Loading';\n\nconst groups = [{\n  key: 'delegates',\n  text: 'Delegates',\n  value: 'Delegates',\n}];\n\nconst delegateStatusOptions = ['trainee_delegate', 'candidate_delegate', 'delegate'];\n\nexport default function RoleForm({ userId, isActiveRole }) {\n  const { data, loading, error } = useLoadedData(roleDataUrl(userId, isActiveRole));\n  const { data: delegateRegions, loading: regionsLoading, error: regionsError } = useLoadedData(\n    apiV0Urls.userGroups.list(groupTypes.delegate_regions),\n  );\n  const { save, saving } = useSaveAction();\n  const selectedGroup = groups[0].value;\n  const [formValues, setFormValues] = React.useState({});\n  const [apiError, setError] = React.useState(false);\n  const [finished, setFinished] = React.useState(false);\n\n  React.useEffect(() => {\n    setFormValues({\n      delegateStatus: delegateStatusOptions[0],\n      location: '',\n      ...(data?.roleData || {}),\n    });\n  }, [data]);\n\n  const updateRole = () => {\n    save(\n      roleUpdateUrl,\n      {\n        userId,\n        ...formValues,\n      },\n      () => setFinished(true),\n      { method: 'PATCH' },\n      () => setError(true),\n    );\n  };\n\n  const endRole = () => {\n    save(\n      roleUpdateUrl,\n      {\n        userId,\n      },\n      () => setFinished(true),\n      { method: 'DELETE' },\n      () => setError(true),\n    );\n  };\n\n  if (loading || regionsLoading || !formValues) return <Loading />;\n  if (error || apiError || regionsError) return <Errored />;\n  if (finished) return 'Success...';\n\n  return (\n    <Form\n      onSubmit={updateRole}\n      loading={saving}\n    >\n      <Form.Dropdown\n        label=\"Group\"\n        fluid\n        selection\n        value={selectedGroup}\n        options={groups}\n      />\n      {selectedGroup === groups[0].value // Delegates is selected\n        && (\n          <DelegateForm\n            formValues={formValues}\n            updateFormProperty={(values) => {\n              setFormValues({\n                ...formValues,\n                ...values,\n              });\n            }}\n            delegateRegions={delegateRegions}\n            delegateStatusOptions={delegateStatusOptions}\n          />\n        )}\n      <Grid>\n        <Form.Button\n          primary\n          type=\"submit\"\n          disabled={(_.isEqual(formValues, data?.roleData))}\n        >\n          {isActiveRole ? 'Update Role' : 'Create Role'}\n        </Form.Button>\n        <Form.Button\n          secondary\n          type=\"button\"\n          onClick={endRole}\n          disabled={!isActiveRole}\n        >\n          End Role\n        </Form.Button>\n      </Grid>\n    </Form>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}