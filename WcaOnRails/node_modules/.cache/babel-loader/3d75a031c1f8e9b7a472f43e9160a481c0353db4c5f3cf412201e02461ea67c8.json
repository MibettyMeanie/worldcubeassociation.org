{"ast":null,"code":"import _toInteger from \"lodash/toInteger\";\nvar _jsxFileName = \"/app/WcaOnRails/app/webpacker/components/Results/WCALive/AttemptResultField/FmField.js\";\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nimport React, { useCallback, useState } from 'react';\nimport { Form } from 'semantic-ui-react';\nimport { DNF_KEYS, DNS_KEYS } from \"./keybindings\";\nimport { SKIPPED_VALUE, DNF_VALUE, DNS_VALUE } from \"../../../../lib/wca-live/attempts\";\nfunction numberToInput(number) {\n  if (number === SKIPPED_VALUE) return '';\n  if (number === DNF_VALUE) return 'DNF';\n  if (number === DNS_VALUE) return 'DNS';\n  return number.toString();\n}\n\n/* eslint react/jsx-props-no-spreading: \"off\" */\nfunction FmField(_ref) {\n  var rawValue = _ref.value,\n    onChange = _ref.onChange,\n    label = _ref.label,\n    disabled = _ref.disabled,\n    _ref$TextFieldProps = _ref.TextFieldProps,\n    TextFieldProps = _ref$TextFieldProps === void 0 ? {} : _ref$TextFieldProps,\n    _ref$resultType = _ref.resultType,\n    resultType = _ref$resultType === void 0 ? 'single' : _ref$resultType;\n  var isAverage = resultType === 'average';\n  // 35 single is stored as 35, 35 average is stored as 3500\n  var value = isAverage ? rawValue / 100 : rawValue;\n  var _useState = useState(value),\n    _useState2 = _slicedToArray(_useState, 2),\n    prevValue = _useState2[0],\n    setPrevValue = _useState2[1];\n  var _useState3 = useState(value),\n    _useState4 = _slicedToArray(_useState3, 2),\n    draftValue = _useState4[0],\n    setDraftValue = _useState4[1];\n\n  // Sync draft value when the upstream value changes.\n  // See AttemptResultField for detailed description.\n  if (prevValue !== value) {\n    setDraftValue(value);\n    setPrevValue(value);\n  }\n  var handleChange = useCallback(function (event) {\n    var key = event.nativeEvent.data;\n    if (DNF_KEYS.includes(key)) {\n      setDraftValue(DNF_VALUE);\n    } else if (DNS_KEYS.includes(key)) {\n      setDraftValue(DNS_VALUE);\n    } else {\n      var newValue = _toInteger(event.target.value.replace(/\\D/g, '')) || SKIPPED_VALUE;\n      setDraftValue(newValue);\n    }\n  }, [setDraftValue]);\n  var handleBlur = useCallback(function () {\n    var parsedDraftValue = isAverage ? draftValue * 100 : draftValue;\n    onChange(parsedDraftValue);\n    // Once we emit the change, reflect the initial state.\n    setDraftValue(value);\n  }, [onChange, draftValue, setDraftValue, value, isAverage]);\n  return /*#__PURE__*/React.createElement(Form.Input, Object.assign({}, TextFieldProps, {\n    label: label,\n    disabled: disabled,\n    spellCheck: false,\n    value: numberToInput(draftValue),\n    onChange: handleChange,\n    onBlur: handleBlur,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 5\n    }\n  }));\n}\nexport default FmField;","map":{"version":3,"names":["React","useCallback","useState","Form","DNF_KEYS","DNS_KEYS","SKIPPED_VALUE","DNF_VALUE","DNS_VALUE","numberToInput","number","toString","FmField","_ref","rawValue","value","onChange","label","disabled","_ref$TextFieldProps","TextFieldProps","_ref$resultType","resultType","isAverage","_useState","_useState2","_slicedToArray","prevValue","setPrevValue","_useState3","_useState4","draftValue","setDraftValue","handleChange","event","key","nativeEvent","data","includes","newValue","_toInteger","target","replace","handleBlur","parsedDraftValue","createElement","Input","Object","assign","spellCheck","onBlur","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/app/WcaOnRails/app/webpacker/components/Results/WCALive/AttemptResultField/FmField.js"],"sourcesContent":["import React, { useCallback, useState } from 'react';\nimport { Form } from 'semantic-ui-react';\nimport _ from 'lodash';\nimport { DNF_KEYS, DNS_KEYS } from './keybindings';\nimport {\n  SKIPPED_VALUE,\n  DNF_VALUE,\n  DNS_VALUE,\n} from '../../../../lib/wca-live/attempts';\n\nfunction numberToInput(number) {\n  if (number === SKIPPED_VALUE) return '';\n  if (number === DNF_VALUE) return 'DNF';\n  if (number === DNS_VALUE) return 'DNS';\n  return number.toString();\n}\n\n/* eslint react/jsx-props-no-spreading: \"off\" */\nfunction FmField({\n  value: rawValue, onChange, label, disabled, TextFieldProps = {}, resultType = 'single',\n}) {\n  const isAverage = resultType === 'average';\n  // 35 single is stored as 35, 35 average is stored as 3500\n  const value = isAverage ? rawValue / 100 : rawValue;\n  const [prevValue, setPrevValue] = useState(value);\n  const [draftValue, setDraftValue] = useState(value);\n\n  // Sync draft value when the upstream value changes.\n  // See AttemptResultField for detailed description.\n  if (prevValue !== value) {\n    setDraftValue(value);\n    setPrevValue(value);\n  }\n\n  const handleChange = useCallback((event) => {\n    const key = event.nativeEvent.data;\n    if (DNF_KEYS.includes(key)) {\n      setDraftValue(DNF_VALUE);\n    } else if (DNS_KEYS.includes(key)) {\n      setDraftValue(DNS_VALUE);\n    } else {\n      const newValue = _.toInteger(event.target.value.replace(/\\D/g, '')) || SKIPPED_VALUE;\n      setDraftValue(newValue);\n    }\n  }, [setDraftValue]);\n\n  const handleBlur = useCallback(() => {\n    const parsedDraftValue = isAverage ? draftValue * 100 : draftValue;\n    onChange(parsedDraftValue);\n    // Once we emit the change, reflect the initial state.\n    setDraftValue(value);\n  }, [onChange, draftValue, setDraftValue, value, isAverage]);\n\n  return (\n    <Form.Input\n      {...TextFieldProps}\n      label={label}\n      disabled={disabled}\n      spellCheck={false}\n      value={numberToInput(draftValue)}\n      onChange={handleChange}\n      onBlur={handleBlur}\n    />\n  );\n}\n\nexport default FmField;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}