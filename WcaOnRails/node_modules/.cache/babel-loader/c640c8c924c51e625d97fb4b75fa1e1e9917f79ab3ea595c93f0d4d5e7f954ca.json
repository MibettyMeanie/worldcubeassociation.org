{"ast":null,"code":"import _times from \"lodash/times\";\nimport _findIndex from \"lodash/findIndex\";\nimport _findLastIndex from \"lodash/findLastIndex\";\nimport _sum from \"lodash/sum\";\nimport _clamp from \"lodash/clamp\";\nvar _jsxFileName = \"/app/WcaOnRails/app/webpacker/components/SchedulesEditor/ActivityPicker.js\";\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\nfunction _possibleConstructorReturn(self, call) { if (call && (typeof call === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nimport React from 'react';\nimport { Col, OverlayTrigger, Panel, Row, Tooltip } from 'react-bootstrap';\nimport cn from 'classnames';\nimport { parseActivityCode, roundIdToString } from \"../../lib/utils/wcif\";\nimport { formats } from \"../../lib/wca-data.js.erb\";\nimport { addActivityToCalendar } from \"../../lib/utils/calendar\";\nimport { schedulesEditPanelSelector } from \"../../lib/helpers/edit-schedule\";\nimport { keyboardHandlers, editScheduleKeyboardHandler } from \"../../lib/helpers/keyboard-handlers\";\nvar activityPickerElementSelector = '#activity-picker-panel';\n\n/* eslint react/prop-types: \"off\" */\n/* eslint max-classes-per-file: \"off\" */\n\nfunction adjustPickerDimension() {\n  var $pickerElem = $(activityPickerElementSelector);\n  var $panelElem = $(schedulesEditPanelSelector);\n  var visibleAvailable = $panelElem.offset().top + $panelElem.outerHeight() - $(window).scrollTop();\n  // 15 is margin bottom we want to keep\n  var headerHeight = $pickerElem.find('.panel-heading').outerHeight();\n  var topPos = 10 + headerHeight;\n  var visibleAvailableForBody = visibleAvailable - topPos - 15;\n  var $bodyElem = $pickerElem.find('.panel-body');\n  $bodyElem.css('height', visibleAvailableForBody);\n}\nfunction computeBasePickerDimension() {\n  var $pickerElem = $(activityPickerElementSelector);\n  // Dynamically fix the width\n  $pickerElem.width($pickerElem.parent().width());\n\n  // Dynamically set the max height for the picker panel body\n  var $bodyElem = $pickerElem.find('.panel-body');\n  // 10 is margin top we want to keep\n  var headerHeight = $pickerElem.find('.panel-heading').outerHeight();\n  var topPos = 10 + headerHeight;\n  var maxPossibleHeight = $(window).height() - topPos - 15;\n  $bodyElem.css('max-height', maxPossibleHeight);\n}\nvar ActivityPicker = /*#__PURE__*/function (_React$Component) {\n  _inherits(ActivityPicker, _React$Component);\n  var _super = _createSuper(ActivityPicker);\n  function ActivityPicker(props) {\n    var _this;\n    _classCallCheck(this, ActivityPicker);\n    _this = _super.call(this, props);\n    keyboardHandlers.activityPicker = function (e) {\n      return editScheduleKeyboardHandler(e, _assertThisInitialized(_this));\n    };\n    _this.trySetSelectedActivity = _this.trySetSelectedActivity.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  /* eslint camelcase: [\"error\", {allow: [\"UNSAFE_componentWillMount\"]}] */\n  _createClass(ActivityPicker, [{\n    key: \"UNSAFE_componentWillMount\",\n    value: function UNSAFE_componentWillMount() {\n      var _this2 = this;\n      this.setState({\n        // event's row selected (from top to bottom)\n        // init to -1, as we are going to force the select of the first down\n        selectedY: -1,\n        // event's round or attempt selected (from left to right)\n        selectedX: 0\n      }, function () {\n        return _this2.trySetSelectedActivity('down', true);\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var $pickerElem = $(activityPickerElementSelector);\n      var $panelElem = $(schedulesEditPanelSelector);\n\n      // The activity picker has a specific behavior when scrolling the window:\n      // it stays affixed to the top of the viewport when scrolling goes below its topmost position.\n      // It also shrinks to a minimum height when reaching the bottom of the viewport.\n      var computeAffixedPickerDimension = function computeAffixedPickerDimension() {\n        computeBasePickerDimension();\n        adjustPickerDimension();\n        var $panelElemHeight = $panelElem.height();\n        $panelElem.css('min-height', $panelElemHeight);\n      };\n      var resetPanelDimension = function resetPanelDimension() {\n        $panelElem.css('min-height', 0);\n      };\n      $pickerElem.affix({\n        offset: {\n          // Dynamically compute the offset trigger, as we're in a collapsible element\n          top: function top() {\n            return $pickerElem.parent().offset().top + 10;\n          }\n        }\n      });\n      $pickerElem.on('affix.bs.affix', computeAffixedPickerDimension);\n      $pickerElem.on('affix-top.bs.affix', resetPanelDimension);\n      // The viewport can be resized when the ActivityPicker is not visible\n      // Therefore we need to compute its dimensions when the panel is made visible\n      $(schedulesEditPanelSelector).find('.panel-collapse').on('shown.bs.collapse', computeBasePickerDimension);\n      $(window).scroll(adjustPickerDimension);\n      $(window).resize(computeBasePickerDimension);\n      $(window).keydown(keyboardHandlers.activityPicker);\n\n      // Activate draggable on all activities\n      $('.activity-in-picker > .schedule-activity').draggable({\n        start: function start(event, ui) {\n          return $(ui.helper).find('.tooltip').hide();\n        },\n        revert: false,\n        helper: 'clone',\n        // To get out of the overflow container\n        appendTo: 'body',\n        cursor: 'copy',\n        cursorAt: {\n          top: 20,\n          left: 10\n        }\n      });\n      $('.activity-in-picker > .schedule-activity').click(function (e) {\n        return addActivityToCalendar($(e.target).data('event'));\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      $(window).off('keydown', keyboardHandlers.activityPicker);\n      $(window).off('resize', computeBasePickerDimension);\n      $(window).off('scroll', adjustPickerDimension);\n    }\n  }, {\n    key: \"trySetSelectedActivity\",\n    value: function trySetSelectedActivity(direction) {\n      var ignoreKeyboard = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var _this$props = this.props,\n        eventsWcif = _this$props.eventsWcif,\n        keyboardEnabled = _this$props.keyboardEnabled;\n      if (!keyboardEnabled && !ignoreKeyboard || eventsWcif.length === 0) {\n        return;\n      }\n      var _this$state = this.state,\n        x = _this$state.selectedX,\n        y = _this$state.selectedY;\n      switch (direction) {\n        case 'up':\n          y -= 1;\n          break;\n        case 'down':\n          y += 1;\n          break;\n        case 'left':\n          x -= 1;\n          break;\n        case 'right':\n          x += 1;\n          break;\n        default:\n          throw new Error(\"Unknown direction: \".concat(direction));\n      }\n      var fixedY = _clamp(y, 0, eventsWcif.length - 1);\n      var fixedX = 0;\n      // Steps to find a suitable row:\n      //  - Create an array of row lengths matching the events.\n      //  - Start at the current position (fixedY) in the array,\n      //  and go either upwards or downwards trying to find positive number of rows.\n      //  - Do not move if we didn't find any suitable row.\n      //  - Get corresponding x value;\n      var rowLengths = eventsWcif.map(function (eventWcif) {\n        return ['333fm', '333mbf'].includes(eventWcif.id) ? _sum(eventWcif.rounds.map(function (round) {\n          return formats.byId[round.format].expectedSolveCount;\n        })) : eventWcif.rounds.length;\n      });\n      var positive = function positive(a) {\n        return a > 0;\n      };\n      if (direction === 'up') {\n        fixedY = _findLastIndex(rowLengths, positive, fixedY);\n      } else if (direction === 'down') {\n        fixedY = _findIndex(rowLengths, positive, fixedY);\n      }\n      if (fixedY < 0) return;\n      var rowLength = rowLengths[fixedY];\n      fixedX = rowLength ? _clamp(x, 0, rowLength - 1) : 0;\n      this.setState({\n        selectedY: fixedY,\n        selectedX: fixedX\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n      var _this$props2 = this.props,\n        eventsWcif = _this$props2.eventsWcif,\n        usedActivityCodeList = _this$props2.usedActivityCodeList,\n        keyboardEnabled = _this$props2.keyboardEnabled;\n      var _this$state2 = this.state,\n        selectedX = _this$state2.selectedX,\n        selectedY = _this$state2.selectedY;\n      if (!keyboardEnabled) {\n        selectedX = -1;\n        selectedY = -1;\n      }\n      return /*#__PURE__*/React.createElement(Panel, {\n        id: \"activity-picker-panel\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(Panel.Heading, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 9\n        }\n      }, \"Activity picker\"), /*#__PURE__*/React.createElement(Panel.Body, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 9\n        }\n      }, eventsWcif.map(function (value, index) {\n        return /*#__PURE__*/React.createElement(ActivityPickerLine, {\n          key: value.id,\n          selectedLine: index === selectedY,\n          eventWcif: value,\n          usedActivityCodeList: usedActivityCodeList,\n          selectedX: selectedX,\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 13\n          }\n        });\n      }), /*#__PURE__*/React.createElement(Col, {\n        xs: 12,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 13\n        }\n      }, \"Want to add a custom activity such as lunch or registration? Click and select a timeframe on the calendar!\"))));\n    }\n  }]);\n  return ActivityPicker;\n}(React.Component);\nexport { ActivityPicker as default };\nfunction ActivityPickerLine(_ref) {\n  var _this4 = this;\n  var eventWcif = _ref.eventWcif,\n    usedActivityCodeList = _ref.usedActivityCodeList,\n    selectedLine = _ref.selectedLine,\n    selectedX = _ref.selectedX;\n  return /*#__PURE__*/React.createElement(Col, {\n    xs: 12,\n    className: \"event-picker-line\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    xs: 12,\n    md: 3,\n    lg: 2,\n    className: \"activity-icon\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: cn('cubing-icon', \"event-\".concat(eventWcif.id)),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Col, {\n    xs: 12,\n    md: 9,\n    lg: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 11\n    }\n  }, eventWcif.rounds.map(function (value, index) {\n    var activities = /*#__PURE__*/React.createElement(ActivitiesForRound, {\n      key: value.id,\n      indexInRow: index,\n      eventId: eventWcif.id,\n      round: value,\n      usedActivityCodeList: usedActivityCodeList,\n      selectedLine: selectedLine,\n      selectedX: selectedX,\n      __self: _this4,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 17\n      }\n    });\n    if (eventWcif.id === '333mbf' || eventWcif.id === '333fm') {\n      // For these events the selectedX spreads accross multiple rounds.\n      // This corrects the offset.\n      /* eslint-disable-next-line */\n      selectedX -= formats.byId[value.format].expectedSolveCount;\n    }\n    return activities;\n  })))));\n}\nfunction ActivitiesForRound(_ref2) {\n  var _this5 = this;\n  var usedActivityCodeList = _ref2.usedActivityCodeList,\n    eventId = _ref2.eventId,\n    round = _ref2.round,\n    selectedLine = _ref2.selectedLine,\n    selectedX = _ref2.selectedX,\n    indexInRow = _ref2.indexInRow;\n  if (['333fm', '333mbf'].includes(eventId)) {\n    var numberOfAttempts = formats.byId[round.format].expectedSolveCount;\n    return _times(numberOfAttempts, function (n) {\n      return /*#__PURE__*/React.createElement(ActivityForAttempt, {\n        activityCode: round.id,\n        usedActivityCodeList: usedActivityCodeList,\n        key: n,\n        attemptNumber: n + 1,\n        selected: selectedLine && selectedX === n,\n        __self: _this5,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 7\n        }\n      });\n    });\n  }\n  return /*#__PURE__*/React.createElement(ActivityForAttempt, {\n    usedActivityCodeList: usedActivityCodeList,\n    activityCode: round.id,\n    selected: selectedLine && selectedX === indexInRow,\n    attemptNumber: null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 5\n    }\n  });\n}\nvar ActivityForAttempt = /*#__PURE__*/function (_React$Component2) {\n  _inherits(ActivityForAttempt, _React$Component2);\n  var _super2 = _createSuper(ActivityForAttempt);\n  function ActivityForAttempt(props) {\n    var _this6;\n    _classCallCheck(this, ActivityForAttempt);\n    _this6 = _super2.call(this, props);\n    _this6.scrollSelectedIntoView = _this6.scrollSelectedIntoView.bind(_assertThisInitialized(_this6));\n    return _this6;\n  }\n  _createClass(ActivityForAttempt, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.scrollSelectedIntoView();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.scrollSelectedIntoView();\n    }\n  }, {\n    key: \"scrollSelectedIntoView\",\n    value: function scrollSelectedIntoView() {\n      if (this.selectedElement) {\n        // Check if the selected element is visible\n        var container = $('#activity-picker-panel').find('.panel-body');\n        var containerHeight = container.height();\n        var containerTop = container.offset().top;\n        var elemPos = $(this.selectedElement).offset().top;\n        var elemHeight = $(this.selectedElement).height();\n        var scrollPos = $(window).scrollTop();\n        var visibleHeight = $(window).height();\n        if (elemPos < containerTop || elemPos > containerTop + containerHeight || elemPos > scrollPos + visibleHeight || elemPos < scrollPos - elemHeight) {\n          // then element is not visible, scroll into it\n          this.selectedElement.scrollIntoView();\n        }\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this7 = this;\n      var _this$props3 = this.props,\n        usedActivityCodeList = _this$props3.usedActivityCodeList,\n        attemptNumber = _this$props3.attemptNumber,\n        selected = _this$props3.selected;\n      var activityCode = this.props.activityCode;\n      var _parseActivityCode = parseActivityCode(activityCode),\n        roundNumber = _parseActivityCode.roundNumber;\n      var tooltipText = roundIdToString(activityCode);\n      var text = \"R\".concat(roundNumber);\n      if (attemptNumber) {\n        tooltipText += \", Attempt \".concat(attemptNumber);\n        text += \"A\".concat(attemptNumber);\n        activityCode += \"-a\".concat(attemptNumber);\n      }\n      var tooltip = /*#__PURE__*/React.createElement(Tooltip, {\n        id: \"tooltip-\".concat(activityCode),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 7\n        }\n      }, tooltipText);\n      var outerCssClasses = ['activity-in-picker', {\n        'col-xs-6 col-md-4 col-lg-3': !attemptNumber\n      }, {\n        'col-xs-12 col-md-6 col-lg-4': attemptNumber\n      }];\n      var innerCssClasses = ['schedule-activity', {\n        'activity-used': usedActivityCodeList.indexOf(activityCode) > -1\n      }, {\n        'selected-activity': selected\n      }];\n      var refFunction = function refFunction(elem) {\n        if (selected) {\n          _this7.selectedElement = elem;\n        }\n      };\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: cn(outerCssClasses),\n        \"data-activity-code\": activityCode,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(OverlayTrigger, {\n        placement: \"top\",\n        overlay: tooltip,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: cn(innerCssClasses),\n        ref: refFunction,\n        \"data-event\": \"{\\\"name\\\": \\\"\".concat(tooltipText, \"\\\", \\\"activityCode\\\": \\\"\").concat(activityCode, \"\\\"}\"),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 330,\n          columnNumber: 11\n        }\n      }, text)));\n    }\n  }]);\n  return ActivityForAttempt;\n}(React.Component);","map":{"version":3,"names":["React","Col","OverlayTrigger","Panel","Row","Tooltip","cn","parseActivityCode","roundIdToString","formats","addActivityToCalendar","schedulesEditPanelSelector","keyboardHandlers","editScheduleKeyboardHandler","activityPickerElementSelector","adjustPickerDimension","$pickerElem","$","$panelElem","visibleAvailable","offset","top","outerHeight","window","scrollTop","headerHeight","find","topPos","visibleAvailableForBody","$bodyElem","css","computeBasePickerDimension","width","parent","maxPossibleHeight","height","ActivityPicker","_React$Component","_inherits","_super","_createSuper","props","_this","_classCallCheck","call","activityPicker","e","_assertThisInitialized","trySetSelectedActivity","bind","_createClass","key","value","UNSAFE_componentWillMount","_this2","setState","selectedY","selectedX","componentDidMount","computeAffixedPickerDimension","$panelElemHeight","resetPanelDimension","affix","on","scroll","resize","keydown","draggable","start","event","ui","helper","hide","revert","appendTo","cursor","cursorAt","left","click","target","data","componentWillUnmount","off","direction","ignoreKeyboard","arguments","length","undefined","_this$props","eventsWcif","keyboardEnabled","_this$state","state","x","y","Error","concat","fixedY","_clamp","fixedX","rowLengths","map","eventWcif","includes","id","_sum","rounds","round","byId","format","expectedSolveCount","positive","a","_findLastIndex","_findIndex","rowLength","render","_this3","_this$props2","usedActivityCodeList","_this$state2","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","Heading","Body","index","ActivityPickerLine","selectedLine","xs","Component","default","_ref","_this4","className","md","lg","activities","ActivitiesForRound","indexInRow","eventId","_ref2","_this5","numberOfAttempts","_times","n","ActivityForAttempt","activityCode","attemptNumber","selected","_React$Component2","_super2","_this6","scrollSelectedIntoView","componentDidUpdate","selectedElement","container","containerHeight","containerTop","elemPos","elemHeight","scrollPos","visibleHeight","scrollIntoView","_this7","_this$props3","_parseActivityCode","roundNumber","tooltipText","text","tooltip","outerCssClasses","innerCssClasses","indexOf","refFunction","elem","placement","overlay","ref"],"sources":["/app/WcaOnRails/app/webpacker/components/SchedulesEditor/ActivityPicker.js"],"sourcesContent":["import React from 'react';\nimport {\n  Col,\n  OverlayTrigger,\n  Panel,\n  Row,\n  Tooltip,\n} from 'react-bootstrap';\nimport _ from 'lodash';\nimport cn from 'classnames';\nimport { parseActivityCode, roundIdToString } from '../../lib/utils/wcif';\nimport { formats } from '../../lib/wca-data.js.erb';\nimport {\n  addActivityToCalendar,\n} from '../../lib/utils/calendar';\nimport { schedulesEditPanelSelector } from '../../lib/helpers/edit-schedule';\nimport { keyboardHandlers, editScheduleKeyboardHandler } from '../../lib/helpers/keyboard-handlers';\n\nconst activityPickerElementSelector = '#activity-picker-panel';\n\n/* eslint react/prop-types: \"off\" */\n/* eslint max-classes-per-file: \"off\" */\n\nfunction adjustPickerDimension() {\n  const $pickerElem = $(activityPickerElementSelector);\n  const $panelElem = $(schedulesEditPanelSelector);\n  const visibleAvailable = $panelElem.offset().top\n    + $panelElem.outerHeight() - $(window).scrollTop();\n  // 15 is margin bottom we want to keep\n  const headerHeight = $pickerElem.find('.panel-heading').outerHeight();\n  const topPos = 10 + headerHeight;\n  const visibleAvailableForBody = visibleAvailable - topPos - 15;\n  const $bodyElem = $pickerElem.find('.panel-body');\n  $bodyElem.css('height', visibleAvailableForBody);\n}\n\nfunction computeBasePickerDimension() {\n  const $pickerElem = $(activityPickerElementSelector);\n  // Dynamically fix the width\n  $pickerElem.width($pickerElem.parent().width());\n\n  // Dynamically set the max height for the picker panel body\n  const $bodyElem = $pickerElem.find('.panel-body');\n  // 10 is margin top we want to keep\n  const headerHeight = $pickerElem.find('.panel-heading').outerHeight();\n  const topPos = 10 + headerHeight;\n  const maxPossibleHeight = $(window).height() - topPos - 15;\n  $bodyElem.css('max-height', maxPossibleHeight);\n}\n\nexport default class ActivityPicker extends React.Component {\n  constructor(props) {\n    super(props);\n    keyboardHandlers.activityPicker = (e) => editScheduleKeyboardHandler(e, this);\n    this.trySetSelectedActivity = this.trySetSelectedActivity.bind(this);\n  }\n\n  /* eslint camelcase: [\"error\", {allow: [\"UNSAFE_componentWillMount\"]}] */\n  UNSAFE_componentWillMount() {\n    this.setState({\n      // event's row selected (from top to bottom)\n      // init to -1, as we are going to force the select of the first down\n      selectedY: -1,\n      // event's round or attempt selected (from left to right)\n      selectedX: 0,\n    }, () => this.trySetSelectedActivity('down', true));\n  }\n\n  componentDidMount() {\n    const $pickerElem = $(activityPickerElementSelector);\n    const $panelElem = $(schedulesEditPanelSelector);\n\n    // The activity picker has a specific behavior when scrolling the window:\n    // it stays affixed to the top of the viewport when scrolling goes below its topmost position.\n    // It also shrinks to a minimum height when reaching the bottom of the viewport.\n    const computeAffixedPickerDimension = () => {\n      computeBasePickerDimension();\n      adjustPickerDimension();\n      const $panelElemHeight = $panelElem.height();\n      $panelElem.css('min-height', $panelElemHeight);\n    };\n\n    const resetPanelDimension = () => {\n      $panelElem.css('min-height', 0);\n    };\n\n    $pickerElem.affix({\n      offset: {\n        // Dynamically compute the offset trigger, as we're in a collapsible element\n        top: () => $pickerElem.parent().offset().top + 10,\n      },\n    });\n    $pickerElem.on('affix.bs.affix', computeAffixedPickerDimension);\n    $pickerElem.on('affix-top.bs.affix', resetPanelDimension);\n    // The viewport can be resized when the ActivityPicker is not visible\n    // Therefore we need to compute its dimensions when the panel is made visible\n    $(schedulesEditPanelSelector).find('.panel-collapse').on('shown.bs.collapse', computeBasePickerDimension);\n    $(window).scroll(adjustPickerDimension);\n    $(window).resize(computeBasePickerDimension);\n    $(window).keydown(keyboardHandlers.activityPicker);\n\n    // Activate draggable on all activities\n    $('.activity-in-picker > .schedule-activity').draggable({\n      start: (event, ui) => $(ui.helper).find('.tooltip').hide(),\n      revert: false,\n      helper: 'clone',\n      // To get out of the overflow container\n      appendTo: 'body',\n      cursor: 'copy',\n      cursorAt: { top: 20, left: 10 },\n    });\n    $('.activity-in-picker > .schedule-activity').click((e) => addActivityToCalendar($(e.target).data('event')));\n  }\n\n  componentWillUnmount() {\n    $(window).off('keydown', keyboardHandlers.activityPicker);\n    $(window).off('resize', computeBasePickerDimension);\n    $(window).off('scroll', adjustPickerDimension);\n  }\n\n  trySetSelectedActivity(direction, ignoreKeyboard = false) {\n    const { eventsWcif, keyboardEnabled } = this.props;\n    if ((!keyboardEnabled && !ignoreKeyboard) || eventsWcif.length === 0) {\n      return;\n    }\n    let { selectedX: x, selectedY: y } = this.state;\n    switch (direction) {\n      case 'up': y -= 1; break;\n      case 'down': y += 1; break;\n      case 'left': x -= 1; break;\n      case 'right': x += 1; break;\n      default: throw new Error(`Unknown direction: ${direction}`);\n    }\n    let fixedY = _.clamp(y, 0, eventsWcif.length - 1);\n    let fixedX = 0;\n    // Steps to find a suitable row:\n    //  - Create an array of row lengths matching the events.\n    //  - Start at the current position (fixedY) in the array,\n    //  and go either upwards or downwards trying to find positive number of rows.\n    //  - Do not move if we didn't find any suitable row.\n    //  - Get corresponding x value;\n    const rowLengths = eventsWcif.map((eventWcif) => (['333fm', '333mbf'].includes(eventWcif.id)\n      ? _.sum(eventWcif.rounds.map((round) => formats.byId[round.format].expectedSolveCount))\n      : eventWcif.rounds.length));\n    const positive = (a) => a > 0;\n    if (direction === 'up') {\n      fixedY = _.findLastIndex(rowLengths, positive, fixedY);\n    } else if (direction === 'down') {\n      fixedY = _.findIndex(rowLengths, positive, fixedY);\n    }\n    if (fixedY < 0) return;\n    const rowLength = rowLengths[fixedY];\n    fixedX = rowLength ? _.clamp(x, 0, rowLength - 1) : 0;\n    this.setState({\n      selectedY: fixedY,\n      selectedX: fixedX,\n    });\n  }\n\n  render() {\n    const {\n      eventsWcif, usedActivityCodeList, keyboardEnabled,\n    } = this.props;\n    let { selectedX, selectedY } = this.state;\n    if (!keyboardEnabled) {\n      selectedX = -1;\n      selectedY = -1;\n    }\n    return (\n      <Panel id=\"activity-picker-panel\">\n        <Panel.Heading>\n          Activity picker\n        </Panel.Heading>\n        <Panel.Body>\n          {eventsWcif.map((value, index) => (\n            <ActivityPickerLine\n              key={value.id}\n              selectedLine={index === selectedY}\n              eventWcif={value}\n              usedActivityCodeList={usedActivityCodeList}\n              selectedX={selectedX}\n            />\n          ))}\n          <Col xs={12}>\n            <p>\n              Want to add a custom activity such as lunch or registration?\n              Click and select a timeframe on the calendar!\n            </p>\n          </Col>\n        </Panel.Body>\n      </Panel>\n    );\n  }\n}\n\nfunction ActivityPickerLine({\n  eventWcif, usedActivityCodeList, selectedLine, selectedX,\n}) {\n  return (\n    <Col xs={12} className=\"event-picker-line\">\n      <Row>\n        <Col xs={12} md={3} lg={2} className=\"activity-icon\">\n          <span className={cn('cubing-icon', `event-${eventWcif.id}`)} />\n        </Col>\n        <Col xs={12} md={9} lg={10}>\n          <Row>\n            {eventWcif.rounds.map((value, index) => {\n              const activities = (\n                <ActivitiesForRound\n                  key={value.id}\n                  indexInRow={index}\n                  eventId={eventWcif.id}\n                  round={value}\n                  usedActivityCodeList={usedActivityCodeList}\n                  selectedLine={selectedLine}\n                  selectedX={selectedX}\n                />\n              );\n              if (eventWcif.id === '333mbf' || eventWcif.id === '333fm') {\n                // For these events the selectedX spreads accross multiple rounds.\n                // This corrects the offset.\n                /* eslint-disable-next-line */\n              selectedX -= formats.byId[value.format].expectedSolveCount;\n              }\n              return activities;\n            })}\n          </Row>\n        </Col>\n      </Row>\n    </Col>\n  );\n}\n\nfunction ActivitiesForRound({\n  usedActivityCodeList, eventId, round, selectedLine, selectedX, indexInRow,\n}) {\n  if (['333fm', '333mbf'].includes(eventId)) {\n    const numberOfAttempts = formats.byId[round.format].expectedSolveCount;\n    return _.times(numberOfAttempts, (n) => (\n      <ActivityForAttempt\n        activityCode={round.id}\n        usedActivityCodeList={usedActivityCodeList}\n        key={n}\n        attemptNumber={n + 1}\n        selected={selectedLine && selectedX === n}\n      />\n    ));\n  }\n  return (\n    <ActivityForAttempt\n      usedActivityCodeList={usedActivityCodeList}\n      activityCode={round.id}\n      selected={selectedLine && selectedX === indexInRow}\n      attemptNumber={null}\n    />\n  );\n}\n\nclass ActivityForAttempt extends React.Component {\n  constructor(props) {\n    super(props);\n    this.scrollSelectedIntoView = this.scrollSelectedIntoView.bind(this);\n  }\n\n  componentDidMount() {\n    this.scrollSelectedIntoView();\n  }\n\n  componentDidUpdate() {\n    this.scrollSelectedIntoView();\n  }\n\n  scrollSelectedIntoView() {\n    if (this.selectedElement) {\n      // Check if the selected element is visible\n      const container = $('#activity-picker-panel').find('.panel-body');\n      const containerHeight = container.height();\n      const containerTop = container.offset().top;\n      const elemPos = $(this.selectedElement).offset().top;\n      const elemHeight = $(this.selectedElement).height();\n      const scrollPos = $(window).scrollTop();\n      const visibleHeight = $(window).height();\n      if (elemPos < containerTop || elemPos > (containerTop + containerHeight)\n          || elemPos > (scrollPos + visibleHeight) || elemPos < (scrollPos - elemHeight)) {\n        // then element is not visible, scroll into it\n        this.selectedElement.scrollIntoView();\n      }\n    }\n  }\n\n  render() {\n    const {\n      usedActivityCodeList, attemptNumber, selected,\n    } = this.props;\n    let { activityCode } = this.props;\n\n    const { roundNumber } = parseActivityCode(activityCode);\n    let tooltipText = roundIdToString(activityCode);\n    let text = `R${roundNumber}`;\n    if (attemptNumber) {\n      tooltipText += `, Attempt ${attemptNumber}`;\n      text += `A${attemptNumber}`;\n      activityCode += `-a${attemptNumber}`;\n    }\n\n    const tooltip = (\n      <Tooltip id={`tooltip-${activityCode}`}>\n        {tooltipText}\n      </Tooltip>\n    );\n    const outerCssClasses = [\n      'activity-in-picker',\n      { 'col-xs-6 col-md-4 col-lg-3': !attemptNumber },\n      { 'col-xs-12 col-md-6 col-lg-4': attemptNumber },\n    ];\n    const innerCssClasses = [\n      'schedule-activity',\n      { 'activity-used': (usedActivityCodeList.indexOf(activityCode) > -1) },\n      { 'selected-activity': selected },\n    ];\n\n    const refFunction = (elem) => {\n      if (selected) {\n        this.selectedElement = elem;\n      }\n    };\n    return (\n      <div className={cn(outerCssClasses)} data-activity-code={activityCode}>\n        <OverlayTrigger placement=\"top\" overlay={tooltip}>\n          <div\n            className={cn(innerCssClasses)}\n            ref={refFunction}\n            data-event={`{\"name\": \"${tooltipText}\", \"activityCode\": \"${activityCode}\"}`}\n          >\n            {text}\n          </div>\n        </OverlayTrigger>\n      </div>\n    );\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}