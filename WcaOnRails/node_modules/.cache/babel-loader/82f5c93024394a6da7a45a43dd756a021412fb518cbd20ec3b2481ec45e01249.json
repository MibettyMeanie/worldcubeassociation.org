{"ast":null,"code":"import _max from \"lodash/max\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nimport { DateTime, Duration } from 'luxon';\nimport { toLuxonDateTime } from '@fullcalendar/luxon3';\nimport { parseActivityCode } from \"./wcif\";\nexport function toMicrodegrees(coord) {\n  return Math.trunc(parseFloat(coord) * 1e6);\n}\nexport function toDegrees(coord) {\n  return coord / 1e6;\n}\nfunction withNestedActivities(activities) {\n  if (activities.length === 0) return [];\n  return [].concat(_toConsumableArray(activities), _toConsumableArray(withNestedActivities(activities.flatMap(function (activity) {\n    return activity.childActivities;\n  }))));\n}\nvar maxIdOrZero = function maxIdOrZero(objects) {\n  return _max(objects.map(function (wcifObj) {\n    return wcifObj.id;\n  })) || 0;\n};\nexport function nextVenueId(wcifSchedule) {\n  // Explore the WCIF to get the highest ids.\n  return maxIdOrZero(wcifSchedule.venues) + 1;\n}\nexport function nextRoomId(wcifSchedule) {\n  // Explore the WCIF to get the highest ids.\n  var rooms = wcifSchedule.venues.flatMap(function (venue) {\n    return venue.rooms;\n  });\n  return maxIdOrZero(rooms) + 1;\n}\nexport function nextActivityId(wcifSchedule) {\n  // Explore the WCIF to get the highest ids.\n  var rooms = wcifSchedule.venues.flatMap(function (venue) {\n    return venue.rooms;\n  });\n  var activities = rooms.flatMap(function (room) {\n    return withNestedActivities(room.activities);\n  });\n  return maxIdOrZero(activities) + 1;\n}\nexport function copyActivity(wcifSchedule, activity) {\n  var newId = activity.id + nextActivityId(wcifSchedule);\n  return _objectSpread(_objectSpread({}, activity), {}, {\n    id: newId,\n    // the recursive call won't see the new activity id added here, but uniqueness\n    // of original activity ids means adding the same constant nextActivityId\n    // everywhere won't create duplicates\n    childActivities: activity.childActivities.map(function (act) {\n      return copyActivity(wcifSchedule, act);\n    })\n  });\n}\nexport function copyRoom(wcifSchedule, room) {\n  var newId = room.id + nextRoomId(wcifSchedule);\n  return _objectSpread(_objectSpread({}, room), {}, {\n    id: newId,\n    activities: room.activities.map(function (activity) {\n      return copyActivity(wcifSchedule, activity);\n    })\n  });\n}\nexport function copyVenue(wcifSchedule, venue) {\n  var newId = venue.id + nextVenueId(wcifSchedule);\n  return _objectSpread(_objectSpread({}, venue), {}, {\n    id: newId,\n    rooms: venue.rooms.map(function (room) {\n      return copyRoom(wcifSchedule, room);\n    })\n  });\n}\nexport function defaultDurationFromActivityCode(activityCode) {\n  var _parseActivityCode = parseActivityCode(activityCode),\n    eventId = _parseActivityCode.eventId;\n  if (eventId === '333fm' || eventId === '333mbf' || activityCode === 'other-lunch' || activityCode === 'other-awards') {\n    return 60;\n  }\n  return 30;\n}\nexport function luxonToWcifIso(luxonDateTime) {\n  return luxonDateTime.toUTC().toISO({\n    suppressMilliseconds: true\n  });\n}\nexport function moveByIsoDuration(isoDateTime, isoDuration) {\n  var luxonDuration = Duration.fromISO(isoDuration);\n  var luxonDateTime = DateTime.fromISO(isoDateTime);\n  var movedDateTime = luxonDateTime.plus(luxonDuration);\n  return luxonToWcifIso(movedDateTime);\n}\nexport function rescaleDuration(isoDuration, scalingFactor) {\n  var luxonDuration = Duration.fromISO(isoDuration);\n  var durationMillis = luxonDuration.toMillis();\n  var scaledMillis = durationMillis * scalingFactor;\n  return Duration.fromMillis(scaledMillis).rescale().toISO();\n}\nexport function changeTimezoneKeepingLocalTime(isoDateTime, oldTimezone, newTimezone) {\n  var luxonDateTime = DateTime.fromISO(isoDateTime);\n  var oldLocalDateTime = luxonDateTime.setZone(oldTimezone);\n  var newZoneSameLocalTime = oldLocalDateTime.setZone(newTimezone, {\n    keepLocalTime: true\n  });\n  return luxonToWcifIso(newZoneSameLocalTime);\n}\nexport function fcEventToActivityAndDates(fcEvent, calendar) {\n  var eventStartLuxon = toLuxonDateTime(fcEvent.start, calendar);\n  var eventEndLuxon = toLuxonDateTime(fcEvent.end, calendar);\n  var utcStartIso = luxonToWcifIso(eventStartLuxon);\n  var utcEndIso = luxonToWcifIso(eventEndLuxon);\n  var _fcEvent$extendedProp = fcEvent.extendedProps,\n    activityCode = _fcEvent$extendedProp.activityCode,\n    activityName = _fcEvent$extendedProp.activityName,\n    childActivities = _fcEvent$extendedProp.childActivities;\n  var activity = {\n    name: activityName,\n    activityCode: activityCode,\n    startTime: utcStartIso,\n    endTime: utcEndIso,\n    childActivities: childActivities || []\n  };\n  return {\n    activity: activity,\n    startLuxon: eventStartLuxon,\n    endLuxon: eventEndLuxon\n  };\n}","map":{"version":3,"names":["DateTime","Duration","toLuxonDateTime","parseActivityCode","toMicrodegrees","coord","Math","trunc","parseFloat","toDegrees","withNestedActivities","activities","length","concat","_toConsumableArray","flatMap","activity","childActivities","maxIdOrZero","objects","_max","map","wcifObj","id","nextVenueId","wcifSchedule","venues","nextRoomId","rooms","venue","nextActivityId","room","copyActivity","newId","_objectSpread","act","copyRoom","copyVenue","defaultDurationFromActivityCode","activityCode","_parseActivityCode","eventId","luxonToWcifIso","luxonDateTime","toUTC","toISO","suppressMilliseconds","moveByIsoDuration","isoDateTime","isoDuration","luxonDuration","fromISO","movedDateTime","plus","rescaleDuration","scalingFactor","durationMillis","toMillis","scaledMillis","fromMillis","rescale","changeTimezoneKeepingLocalTime","oldTimezone","newTimezone","oldLocalDateTime","setZone","newZoneSameLocalTime","keepLocalTime","fcEventToActivityAndDates","fcEvent","calendar","eventStartLuxon","start","eventEndLuxon","end","utcStartIso","utcEndIso","_fcEvent$extendedProp","extendedProps","activityName","name","startTime","endTime","startLuxon","endLuxon"],"sources":["/app/WcaOnRails/app/webpacker/lib/utils/edit-schedule.js"],"sourcesContent":["import _ from 'lodash';\nimport { DateTime, Duration } from 'luxon';\nimport { toLuxonDateTime } from '@fullcalendar/luxon3';\nimport { parseActivityCode } from './wcif';\n\nexport function toMicrodegrees(coord) {\n  return Math.trunc(parseFloat(coord) * 1e6);\n}\n\nexport function toDegrees(coord) {\n  return coord / 1e6;\n}\n\nfunction withNestedActivities(activities) {\n  if (activities.length === 0) return [];\n\n  return [\n    ...activities,\n    ...withNestedActivities(activities.flatMap((activity) => activity.childActivities)),\n  ];\n}\n\nconst maxIdOrZero = (objects) => _.max(objects.map((wcifObj) => wcifObj.id)) || 0;\n\nexport function nextVenueId(wcifSchedule) {\n  // Explore the WCIF to get the highest ids.\n  return maxIdOrZero(wcifSchedule.venues) + 1;\n}\n\nexport function nextRoomId(wcifSchedule) {\n  // Explore the WCIF to get the highest ids.\n  const rooms = wcifSchedule.venues.flatMap((venue) => venue.rooms);\n  return maxIdOrZero(rooms) + 1;\n}\n\nexport function nextActivityId(wcifSchedule) {\n  // Explore the WCIF to get the highest ids.\n  const rooms = wcifSchedule.venues.flatMap((venue) => venue.rooms);\n  const activities = rooms.flatMap((room) => withNestedActivities(room.activities));\n  return maxIdOrZero(activities) + 1;\n}\n\nexport function copyActivity(wcifSchedule, activity) {\n  const newId = activity.id + nextActivityId(wcifSchedule);\n  return {\n    ...activity,\n    id: newId,\n    // the recursive call won't see the new activity id added here, but uniqueness\n    // of original activity ids means adding the same constant nextActivityId\n    // everywhere won't create duplicates\n    childActivities: activity.childActivities.map((act) => copyActivity(wcifSchedule, act)),\n  };\n}\n\nexport function copyRoom(wcifSchedule, room) {\n  const newId = room.id + nextRoomId(wcifSchedule);\n  return {\n    ...room,\n    id: newId,\n    activities: room.activities.map((activity) => copyActivity(wcifSchedule, activity)),\n  };\n}\n\nexport function copyVenue(wcifSchedule, venue) {\n  const newId = venue.id + nextVenueId(wcifSchedule);\n  return {\n    ...venue,\n    id: newId,\n    rooms: venue.rooms.map((room) => copyRoom(wcifSchedule, room)),\n  };\n}\n\nexport function defaultDurationFromActivityCode(activityCode) {\n  const { eventId } = parseActivityCode(activityCode);\n  if (eventId === '333fm' || eventId === '333mbf'\n      || activityCode === 'other-lunch' || activityCode === 'other-awards') {\n    return 60;\n  }\n  return 30;\n}\n\nexport function luxonToWcifIso(luxonDateTime) {\n  return luxonDateTime.toUTC().toISO({ suppressMilliseconds: true });\n}\n\nexport function moveByIsoDuration(isoDateTime, isoDuration) {\n  const luxonDuration = Duration.fromISO(isoDuration);\n  const luxonDateTime = DateTime.fromISO(isoDateTime);\n\n  const movedDateTime = luxonDateTime.plus(luxonDuration);\n\n  return luxonToWcifIso(movedDateTime);\n}\n\nexport function rescaleDuration(isoDuration, scalingFactor) {\n  const luxonDuration = Duration.fromISO(isoDuration);\n\n  const durationMillis = luxonDuration.toMillis();\n  const scaledMillis = durationMillis * scalingFactor;\n\n  return Duration.fromMillis(scaledMillis).rescale().toISO();\n}\n\nexport function changeTimezoneKeepingLocalTime(isoDateTime, oldTimezone, newTimezone) {\n  const luxonDateTime = DateTime.fromISO(isoDateTime);\n\n  const oldLocalDateTime = luxonDateTime.setZone(oldTimezone);\n  const newZoneSameLocalTime = oldLocalDateTime.setZone(newTimezone, { keepLocalTime: true });\n\n  return luxonToWcifIso(newZoneSameLocalTime);\n}\n\nexport function fcEventToActivityAndDates(fcEvent, calendar) {\n  const eventStartLuxon = toLuxonDateTime(fcEvent.start, calendar);\n  const eventEndLuxon = toLuxonDateTime(fcEvent.end, calendar);\n\n  const utcStartIso = luxonToWcifIso(eventStartLuxon);\n  const utcEndIso = luxonToWcifIso(eventEndLuxon);\n\n  const { activityCode, activityName, childActivities } = fcEvent.extendedProps;\n\n  const activity = {\n    name: activityName,\n    activityCode,\n    startTime: utcStartIso,\n    endTime: utcEndIso,\n    childActivities: childActivities || [],\n  };\n\n  return {\n    activity,\n    startLuxon: eventStartLuxon,\n    endLuxon: eventEndLuxon,\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}