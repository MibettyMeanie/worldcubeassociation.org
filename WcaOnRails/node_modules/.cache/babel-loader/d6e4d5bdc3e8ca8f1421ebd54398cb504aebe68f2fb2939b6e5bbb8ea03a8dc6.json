{"ast":null,"code":"import _toInteger from \"lodash/toInteger\";\nvar _jsxFileName = \"/app/WcaOnRails/app/webpacker/components/Results/WCALive/AttemptResultField/TimeField.js\";\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nimport React, { useState, useCallback } from 'react';\nimport { Form } from 'semantic-ui-react';\nimport { DNF_KEYS, DNS_KEYS } from \"./keybindings\";\nimport { DNF_VALUE, SKIPPED_VALUE, DNS_VALUE, centisecondsToClockFormat } from \"../../../../lib/wca-live/attempts\";\nfunction reformatInput(input) {\n  var number = _toInteger(input.replace(/\\D/g, '')) || 0;\n  if (number === 0) return '';\n  var str = \"00000000\".concat(number.toString().slice(0, 8));\n  var _str$match = str.match(/(\\d\\d)(\\d\\d)(\\d\\d)(\\d\\d)$/),\n    _str$match2 = _slicedToArray(_str$match, 5),\n    hh = _str$match2[1],\n    mm = _str$match2[2],\n    ss = _str$match2[3],\n    cc = _str$match2[4];\n  return \"\".concat(hh, \":\").concat(mm, \":\").concat(ss, \".\").concat(cc).replace(/^[0:]*(?!\\.)/g, '');\n}\nfunction inputToAttemptResult(input) {\n  if (input === '') return SKIPPED_VALUE;\n  if (input === 'DNF') return DNF_VALUE;\n  if (input === 'DNS') return DNS_VALUE;\n  var num = _toInteger(input.replace(/\\D/g, '')) || 0;\n  return Math.floor(num / 1000000) * 360000 + Math.floor(num % 1000000 / 10000) * 6000 + Math.floor(num % 10000 / 100) * 100 + num % 100;\n}\nfunction attemptResultToInput(attemptResult) {\n  if (attemptResult === SKIPPED_VALUE) return '';\n  if (attemptResult === DNF_VALUE) return 'DNF';\n  if (attemptResult === DNS_VALUE) return 'DNS';\n  return centisecondsToClockFormat(attemptResult);\n}\nfunction isValid(input) {\n  return input === attemptResultToInput(inputToAttemptResult(input));\n}\n\n/* eslint react/jsx-props-no-spreading: \"off\" */\nfunction TimeField(_ref) {\n  var value = _ref.value,\n    onChange = _ref.onChange,\n    label = _ref.label,\n    disabled = _ref.disabled,\n    _ref$TextFieldProps = _ref.TextFieldProps,\n    TextFieldProps = _ref$TextFieldProps === void 0 ? {} : _ref$TextFieldProps;\n  var _useState = useState(value),\n    _useState2 = _slicedToArray(_useState, 2),\n    prevValue = _useState2[0],\n    setPrevValue = _useState2[1];\n  var _useState3 = useState(attemptResultToInput(value)),\n    _useState4 = _slicedToArray(_useState3, 2),\n    draftInput = _useState4[0],\n    setDraftInput = _useState4[1];\n\n  // Sync draft value when the upstream value changes.\n  // See AttemptResultField for detailed description.\n  if (prevValue !== value) {\n    setDraftInput(attemptResultToInput(value));\n    setPrevValue(value);\n  }\n  var handleChange = useCallback(function (event) {\n    var key = event.nativeEvent.data;\n    if (DNF_KEYS.includes(key)) {\n      setDraftInput('DNF');\n    } else if (DNS_KEYS.includes(key)) {\n      setDraftInput('DNS');\n    } else {\n      setDraftInput(reformatInput(event.target.value));\n    }\n  }, [setDraftInput]);\n  var handleBlur = useCallback(function () {\n    var attempt = isValid(draftInput) ? inputToAttemptResult(draftInput) : SKIPPED_VALUE;\n    onChange(attempt);\n    // Once we emit the change, reflect the initial state.\n    setDraftInput(attemptResultToInput(value));\n  }, [draftInput, onChange, setDraftInput, value]);\n  return /*#__PURE__*/React.createElement(Form.Input, Object.assign({}, TextFieldProps, {\n    label: label,\n    disabled: disabled,\n    spellCheck: false,\n    value: draftInput,\n    onChange: handleChange,\n    onBlur: handleBlur,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 5\n    }\n  }));\n}\nexport default TimeField;","map":{"version":3,"names":["React","useState","useCallback","Form","DNF_KEYS","DNS_KEYS","DNF_VALUE","SKIPPED_VALUE","DNS_VALUE","centisecondsToClockFormat","reformatInput","input","number","_toInteger","replace","str","concat","toString","slice","_str$match","match","_str$match2","_slicedToArray","hh","mm","ss","cc","inputToAttemptResult","num","Math","floor","attemptResultToInput","attemptResult","isValid","TimeField","_ref","value","onChange","label","disabled","_ref$TextFieldProps","TextFieldProps","_useState","_useState2","prevValue","setPrevValue","_useState3","_useState4","draftInput","setDraftInput","handleChange","event","key","nativeEvent","data","includes","target","handleBlur","attempt","createElement","Input","Object","assign","spellCheck","onBlur","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["/app/WcaOnRails/app/webpacker/components/Results/WCALive/AttemptResultField/TimeField.js"],"sourcesContent":["import React, { useState, useCallback } from 'react';\nimport { Form } from 'semantic-ui-react';\nimport _ from 'lodash';\nimport { DNF_KEYS, DNS_KEYS } from './keybindings';\nimport {\n  DNF_VALUE,\n  SKIPPED_VALUE,\n  DNS_VALUE,\n  centisecondsToClockFormat,\n} from '../../../../lib/wca-live/attempts';\n\nfunction reformatInput(input) {\n  const number = _.toInteger(input.replace(/\\D/g, '')) || 0;\n  if (number === 0) return '';\n  const str = `00000000${number.toString().slice(0, 8)}`;\n  const [, hh, mm, ss, cc] = str.match(/(\\d\\d)(\\d\\d)(\\d\\d)(\\d\\d)$/);\n  return `${hh}:${mm}:${ss}.${cc}`.replace(/^[0:]*(?!\\.)/g, '');\n}\n\nfunction inputToAttemptResult(input) {\n  if (input === '') return SKIPPED_VALUE;\n  if (input === 'DNF') return DNF_VALUE;\n  if (input === 'DNS') return DNS_VALUE;\n  const num = _.toInteger(input.replace(/\\D/g, '')) || 0;\n  return (\n    Math.floor(num / 1000000) * 360000\n    + Math.floor((num % 1000000) / 10000) * 6000\n    + Math.floor((num % 10000) / 100) * 100\n    + (num % 100)\n  );\n}\n\nfunction attemptResultToInput(attemptResult) {\n  if (attemptResult === SKIPPED_VALUE) return '';\n  if (attemptResult === DNF_VALUE) return 'DNF';\n  if (attemptResult === DNS_VALUE) return 'DNS';\n  return centisecondsToClockFormat(attemptResult);\n}\n\nfunction isValid(input) {\n  return input === attemptResultToInput(inputToAttemptResult(input));\n}\n\n/* eslint react/jsx-props-no-spreading: \"off\" */\nfunction TimeField({\n  value, onChange, label, disabled, TextFieldProps = {},\n}) {\n  const [prevValue, setPrevValue] = useState(value);\n  const [draftInput, setDraftInput] = useState(attemptResultToInput(value));\n\n  // Sync draft value when the upstream value changes.\n  // See AttemptResultField for detailed description.\n  if (prevValue !== value) {\n    setDraftInput(attemptResultToInput(value));\n    setPrevValue(value);\n  }\n\n  const handleChange = useCallback((event) => {\n    const key = event.nativeEvent.data;\n    if (DNF_KEYS.includes(key)) {\n      setDraftInput('DNF');\n    } else if (DNS_KEYS.includes(key)) {\n      setDraftInput('DNS');\n    } else {\n      setDraftInput(reformatInput(event.target.value));\n    }\n  }, [setDraftInput]);\n\n  const handleBlur = useCallback(() => {\n    const attempt = isValid(draftInput)\n      ? inputToAttemptResult(draftInput)\n      : SKIPPED_VALUE;\n    onChange(attempt);\n    // Once we emit the change, reflect the initial state.\n    setDraftInput(attemptResultToInput(value));\n  }, [draftInput, onChange, setDraftInput, value]);\n\n  return (\n    <Form.Input\n      {...TextFieldProps}\n      label={label}\n      disabled={disabled}\n      spellCheck={false}\n      value={draftInput}\n      onChange={handleChange}\n      onBlur={handleBlur}\n    />\n  );\n}\n\nexport default TimeField;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}