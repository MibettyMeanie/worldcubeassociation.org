{"ast":null,"code":"import _remove from \"lodash/remove\";\nimport _isEqual from \"lodash/isEqual\";\nvar _jsxFileName = \"/app/WcaOnRails/app/webpacker/components/EditEvents/index.js\";\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Button, Message } from 'semantic-ui-react';\nimport { events } from \"../../lib/wca-data.js.erb\";\nimport { saveWcif } from \"../../lib/utils/wcif\";\nimport EventPanel from \"./EventPanel\";\nimport { changesSaved } from \"./store/actions\";\nimport wcifEventsReducer from \"./store/reducer\";\nimport Store, { useDispatch, useStore } from \"../../lib/providers/StoreProvider\";\nimport ConfirmProvider from \"../../lib/providers/ConfirmProvider\";\nfunction EditEvents() {\n  var _this = this;\n  var _useStore = useStore(),\n    competitionId = _useStore.competitionId,\n    wcifEvents = _useStore.wcifEvents,\n    initialWcifEvents = _useStore.initialWcifEvents;\n  var dispatch = useDispatch();\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    saving = _useState2[0],\n    setSaving = _useState2[1];\n  var unsavedChanges = useMemo(function () {\n    return !_isEqual(wcifEvents, initialWcifEvents);\n  }, [wcifEvents, initialWcifEvents]);\n  var onUnload = useCallback(function (e) {\n    // Prompt the user before letting them navigate away from this page with unsaved changes.\n    if (unsavedChanges) {\n      var confirmationMessage = 'You have unsaved changes, are you sure you want to leave?';\n      e.returnValue = confirmationMessage;\n      return confirmationMessage;\n    }\n    return null;\n  }, [unsavedChanges]);\n  useEffect(function () {\n    window.addEventListener('beforeunload', onUnload);\n    return function () {\n      window.removeEventListener('beforeunload', onUnload);\n    };\n  }, [onUnload]);\n  var save = useCallback(function () {\n    setSaving(true);\n    var onSuccess = function onSuccess() {\n      setSaving(false);\n      dispatch(changesSaved());\n    };\n    var onFailure = function onFailure() {\n      setSaving(false);\n    };\n    saveWcif(competitionId, {\n      events: wcifEvents\n    }, onSuccess, onFailure);\n  }, [competitionId, dispatch, wcifEvents]);\n  var renderUnsavedChangesAlert = function renderUnsavedChangesAlert() {\n    return /*#__PURE__*/React.createElement(Message, {\n      color: \"blue\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 5\n      }\n    }, \"You have unsaved changes. Don't forget to\", ' ', /*#__PURE__*/React.createElement(Button, {\n      onClick: save,\n      disabled: saving,\n      loading: saving,\n      color: \"blue\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 7\n      }\n    }, \"save your changes!\"));\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 5\n    }\n  }, unsavedChanges && renderUnsavedChangesAlert(), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      // https://css-tricks.com/an-auto-filling-css-grid-with-max-columns/\n      display: 'grid',\n      gridTemplateColumns: 'repeat(auto-fill, minmax(max(400px, calc((100% - calc(calc(3 - 1) * 1em)) / 3)), 1fr))',\n      gridGap: '1em',\n      alignItems: 'baseline'\n    },\n    className: \"event-panel-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 7\n    }\n  }, wcifEvents.map(function (wcifEvent) {\n    return /*#__PURE__*/React.createElement(EventPanel, {\n      key: wcifEvent.id,\n      wcifEvent: wcifEvent,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 11\n      }\n    });\n  })), unsavedChanges && renderUnsavedChangesAlert());\n}\nfunction normalizeWcifEvents(wcifEvents) {\n  // Since we want to support deprecated events and be able to edit their rounds,\n  // we want to show deprecated events if they exist in the WCIF, but not if they\n  // don't.\n  // Therefore we first build the list of events from the official one, updating\n  // it with WCIF data if any.\n  // And then we add all events that are still in the WCIF (which means they are\n  // not official anymore).\n  var ret = events.official.map(function (event) {\n    return _remove(wcifEvents, {\n      id: event.id\n    })[0] || {\n      id: event.id,\n      rounds: null\n    };\n  });\n  return ret.concat(wcifEvents);\n}\nexport default function Wrapper(_ref) {\n  var competitionId = _ref.competitionId,\n    canAddAndRemoveEvents = _ref.canAddAndRemoveEvents,\n    canUpdateEvents = _ref.canUpdateEvents,\n    canUpdateQualifications = _ref.canUpdateQualifications,\n    wcifEvents = _ref.wcifEvents;\n  var normalizedEvents = normalizeWcifEvents(wcifEvents);\n  return /*#__PURE__*/React.createElement(Store, {\n    reducer: wcifEventsReducer,\n    initialState: {\n      competitionId: competitionId,\n      canAddAndRemoveEvents: canAddAndRemoveEvents,\n      canUpdateEvents: canUpdateEvents,\n      canUpdateQualifications: canUpdateQualifications,\n      wcifEvents: normalizedEvents,\n      initialWcifEvents: normalizedEvents,\n      unsavedChanges: false\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(ConfirmProvider, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(EditEvents, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }\n  })));\n}","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useState","Button","Message","events","saveWcif","EventPanel","changesSaved","wcifEventsReducer","Store","useDispatch","useStore","ConfirmProvider","EditEvents","_this","_useStore","competitionId","wcifEvents","initialWcifEvents","dispatch","_useState","_useState2","_slicedToArray","saving","setSaving","unsavedChanges","_isEqual","onUnload","e","confirmationMessage","returnValue","window","addEventListener","removeEventListener","save","onSuccess","onFailure","renderUnsavedChangesAlert","createElement","color","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","loading","style","display","gridTemplateColumns","gridGap","alignItems","className","map","wcifEvent","key","id","normalizeWcifEvents","ret","official","event","_remove","rounds","concat","Wrapper","_ref","canAddAndRemoveEvents","canUpdateEvents","canUpdateQualifications","normalizedEvents","reducer","initialState"],"sources":["/app/WcaOnRails/app/webpacker/components/EditEvents/index.js"],"sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport _ from 'lodash';\n\nimport { Button, Message } from 'semantic-ui-react';\nimport { events } from '../../lib/wca-data.js.erb';\n\nimport { saveWcif } from '../../lib/utils/wcif';\nimport EventPanel from './EventPanel';\nimport { changesSaved } from './store/actions';\nimport wcifEventsReducer from './store/reducer';\nimport Store, { useDispatch, useStore } from '../../lib/providers/StoreProvider';\nimport ConfirmProvider from '../../lib/providers/ConfirmProvider';\n\nfunction EditEvents() {\n  const {\n    competitionId, wcifEvents, initialWcifEvents,\n  } = useStore();\n  const dispatch = useDispatch();\n  const [saving, setSaving] = useState(false);\n\n  const unsavedChanges = useMemo(() => (\n    !_.isEqual(wcifEvents, initialWcifEvents)\n  ), [wcifEvents, initialWcifEvents]);\n\n  const onUnload = useCallback((e) => {\n    // Prompt the user before letting them navigate away from this page with unsaved changes.\n    if (unsavedChanges) {\n      const confirmationMessage = 'You have unsaved changes, are you sure you want to leave?';\n      e.returnValue = confirmationMessage;\n      return confirmationMessage;\n    }\n\n    return null;\n  }, [unsavedChanges]);\n\n  useEffect(() => {\n    window.addEventListener('beforeunload', onUnload);\n\n    return () => {\n      window.removeEventListener('beforeunload', onUnload);\n    };\n  }, [onUnload]);\n\n  const save = useCallback(() => {\n    setSaving(true);\n\n    const onSuccess = () => {\n      setSaving(false);\n      dispatch(changesSaved());\n    };\n\n    const onFailure = () => {\n      setSaving(false);\n    };\n\n    saveWcif(competitionId, { events: wcifEvents }, onSuccess, onFailure);\n  }, [competitionId, dispatch, wcifEvents]);\n\n  const renderUnsavedChangesAlert = () => (\n    <Message color=\"blue\">\n      You have unsaved changes. Don&apos;t forget to\n      {' '}\n      <Button\n        onClick={save}\n        disabled={saving}\n        loading={saving}\n        color=\"blue\"\n      >\n        save your changes!\n      </Button>\n    </Message>\n  );\n\n  return (\n    <div>\n      {unsavedChanges && renderUnsavedChangesAlert()}\n      <div\n        style={{\n          // https://css-tricks.com/an-auto-filling-css-grid-with-max-columns/\n          display: 'grid',\n          gridTemplateColumns: 'repeat(auto-fill, minmax(max(400px, calc((100% - calc(calc(3 - 1) * 1em)) / 3)), 1fr))',\n          gridGap: '1em',\n          alignItems: 'baseline',\n        }}\n        className=\"event-panel-container\"\n      >\n        {wcifEvents.map((wcifEvent) => (\n          <EventPanel key={wcifEvent.id} wcifEvent={wcifEvent} />\n        ))}\n      </div>\n      {unsavedChanges && renderUnsavedChangesAlert()}\n    </div>\n  );\n}\n\nfunction normalizeWcifEvents(wcifEvents) {\n  // Since we want to support deprecated events and be able to edit their rounds,\n  // we want to show deprecated events if they exist in the WCIF, but not if they\n  // don't.\n  // Therefore we first build the list of events from the official one, updating\n  // it with WCIF data if any.\n  // And then we add all events that are still in the WCIF (which means they are\n  // not official anymore).\n  const ret = events.official.map(\n    (event) => _.remove(wcifEvents, { id: event.id })[0] || {\n      id: event.id,\n      rounds: null,\n    },\n  );\n  return ret.concat(wcifEvents);\n}\n\nexport default function Wrapper({\n  competitionId,\n  canAddAndRemoveEvents,\n  canUpdateEvents,\n  canUpdateQualifications,\n  wcifEvents,\n}) {\n  const normalizedEvents = normalizeWcifEvents(wcifEvents);\n\n  return (\n    <Store\n      reducer={wcifEventsReducer}\n      initialState={{\n        competitionId,\n        canAddAndRemoveEvents,\n        canUpdateEvents,\n        canUpdateQualifications,\n        wcifEvents: normalizedEvents,\n        initialWcifEvents: normalizedEvents,\n        unsavedChanges: false,\n      }}\n    >\n      <ConfirmProvider>\n        <EditEvents />\n      </ConfirmProvider>\n    </Store>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}