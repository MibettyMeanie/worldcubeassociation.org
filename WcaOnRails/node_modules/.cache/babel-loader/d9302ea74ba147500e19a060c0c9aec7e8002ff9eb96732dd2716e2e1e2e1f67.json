{"ast":null,"code":"var _jsxFileName = \"/app/WcaOnRails/app/webpacker/components/CompetitionsOverview/CompetitionsView.js\";\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nimport React, { useReducer, useMemo, useState } from 'react';\nimport { useInfiniteQuery } from '@tanstack/react-query';\nimport { Container } from 'semantic-ui-react';\nimport I18n from \"../../lib/i18n\";\nimport { apiV0Urls, WCA_API_PAGINATION } from \"../../lib/requests/routes.js.erb\";\nimport { fetchJsonOrError } from \"../../lib/requests/fetchWithAuthenticityToken\";\nimport CompetitionsFilters from \"./CompetitionsFilters\";\nimport ListView from \"./ListView\";\nimport MapView from \"./MapView\";\nimport { filterReducer, filterInitialState } from \"./filterUtils\";\nimport { calculateQueryKey, createSearchParams } from \"./queryUtils\";\nimport { isCancelled, isInProgress, isProbablyOver } from \"../../lib/utils/competition-table\";\nfunction CompetitionsView() {\n  var _useReducer = useReducer(filterReducer, filterInitialState),\n    _useReducer2 = _slicedToArray(_useReducer, 2),\n    filterState = _useReducer2[0],\n    dispatchFilter = _useReducer2[1];\n  var _useState = useState('list'),\n    _useState2 = _slicedToArray(_useState, 2),\n    displayMode = _useState2[0],\n    setDisplayMode = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    shouldShowRegStatus = _useState4[0],\n    setShouldShowRegStatus = _useState4[1];\n  var competitionQueryKey = useMemo(function () {\n    return calculateQueryKey(filterState);\n  }, [filterState]);\n  var _useInfiniteQuery = useInfiniteQuery({\n      queryKey: ['competitions', competitionQueryKey],\n      queryFn: function queryFn(_ref) {\n        var _ref$pageParam = _ref.pageParam,\n          pageParam = _ref$pageParam === void 0 ? 1 : _ref$pageParam;\n        var searchParams = createSearchParams(filterState, pageParam);\n        return fetchJsonOrError(\"\".concat(apiV0Urls.competitions.list, \"?\").concat(searchParams));\n      },\n      getNextPageParam: function getNextPageParam(previousPage, allPages) {\n        // Continue until less than a full page of data is fetched,\n        // which indicates the very last page.\n        if (previousPage.data.length < WCA_API_PAGINATION) {\n          return undefined;\n        }\n        return allPages.length + 1;\n      }\n    }),\n    rawCompetitionData = _useInfiniteQuery.data,\n    competitionsFetchNextPage = _useInfiniteQuery.fetchNextPage,\n    competitionsIsFetching = _useInfiniteQuery.isFetching,\n    hasMoreCompsToLoad = _useInfiniteQuery.hasNextPage;\n  var competitions = rawCompetitionData === null || rawCompetitionData === void 0 ? void 0 : rawCompetitionData.pages.flatMap(function (page) {\n    return page.data;\n  }).filter(function (comp) {\n    return (!isCancelled(comp) || filterState.shouldIncludeCancelled) && filterState.selectedEvents.every(function (event) {\n      return comp.event_ids.includes(event);\n    });\n  });\n  return /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 7\n    }\n  }, I18n.t('competitions.index.title')), /*#__PURE__*/React.createElement(CompetitionsFilters, {\n    filterState: filterState,\n    dispatchFilter: dispatchFilter,\n    displayMode: displayMode,\n    setDisplayMode: setDisplayMode,\n    shouldShowRegStatus: shouldShowRegStatus,\n    setShouldShowRegStatus: setShouldShowRegStatus,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Container, {\n    id: \"search-results\",\n    className: \"row competitions-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }\n  }, displayMode === 'list' && /*#__PURE__*/React.createElement(ListView, {\n    competitions: competitions,\n    filterState: filterState,\n    shouldShowRegStatus: shouldShowRegStatus,\n    isLoading: competitionsIsFetching,\n    fetchMoreCompetitions: competitionsFetchNextPage,\n    hasMoreCompsToLoad: hasMoreCompsToLoad,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 13\n    }\n  }), displayMode === 'map' && /*#__PURE__*/React.createElement(MapView, {\n    competitions: filterState.timeOrder === 'present' ? competitions === null || competitions === void 0 ? void 0 : competitions.filter(function (comp) {\n      return !isInProgress(comp) && !isProbablyOver(comp);\n    }) : competitions,\n    fetchMoreCompetitions: competitionsFetchNextPage,\n    hasMoreCompsToLoad: hasMoreCompsToLoad,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }\n  })));\n}\nexport default CompetitionsView;","map":{"version":3,"names":["React","useReducer","useMemo","useState","useInfiniteQuery","Container","I18n","apiV0Urls","WCA_API_PAGINATION","fetchJsonOrError","CompetitionsFilters","ListView","MapView","filterReducer","filterInitialState","calculateQueryKey","createSearchParams","isCancelled","isInProgress","isProbablyOver","CompetitionsView","_useReducer","_useReducer2","_slicedToArray","filterState","dispatchFilter","_useState","_useState2","displayMode","setDisplayMode","_useState3","_useState4","shouldShowRegStatus","setShouldShowRegStatus","competitionQueryKey","_useInfiniteQuery","queryKey","queryFn","_ref","_ref$pageParam","pageParam","searchParams","concat","competitions","list","getNextPageParam","previousPage","allPages","data","length","undefined","rawCompetitionData","competitionsFetchNextPage","fetchNextPage","competitionsIsFetching","isFetching","hasMoreCompsToLoad","hasNextPage","pages","flatMap","page","filter","comp","shouldIncludeCancelled","selectedEvents","every","event","event_ids","includes","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","t","id","className","isLoading","fetchMoreCompetitions","timeOrder"],"sources":["/app/WcaOnRails/app/webpacker/components/CompetitionsOverview/CompetitionsView.js"],"sourcesContent":["import React, {\n  useReducer, useMemo, useState,\n} from 'react';\nimport { useInfiniteQuery } from '@tanstack/react-query';\nimport { Container } from 'semantic-ui-react';\n\nimport I18n from '../../lib/i18n';\nimport { apiV0Urls, WCA_API_PAGINATION } from '../../lib/requests/routes.js.erb';\nimport { fetchJsonOrError } from '../../lib/requests/fetchWithAuthenticityToken';\n\nimport CompetitionsFilters from './CompetitionsFilters';\nimport ListView from './ListView';\nimport MapView from './MapView';\nimport { filterReducer, filterInitialState } from './filterUtils';\nimport { calculateQueryKey, createSearchParams } from './queryUtils';\nimport { isCancelled, isInProgress, isProbablyOver } from '../../lib/utils/competition-table';\n\nfunction CompetitionsView() {\n  const [filterState, dispatchFilter] = useReducer(filterReducer, filterInitialState);\n  const [displayMode, setDisplayMode] = useState('list');\n  const [shouldShowRegStatus, setShouldShowRegStatus] = useState(false);\n  const competitionQueryKey = useMemo(() => calculateQueryKey(filterState), [filterState]);\n\n  const {\n    data: rawCompetitionData,\n    fetchNextPage: competitionsFetchNextPage,\n    isFetching: competitionsIsFetching,\n    hasNextPage: hasMoreCompsToLoad,\n  } = useInfiniteQuery({\n    queryKey: ['competitions', competitionQueryKey],\n    queryFn: ({ pageParam = 1 }) => {\n      const searchParams = createSearchParams(filterState, pageParam);\n      return fetchJsonOrError(`${apiV0Urls.competitions.list}?${searchParams}`);\n    },\n    getNextPageParam: (previousPage, allPages) => {\n      // Continue until less than a full page of data is fetched,\n      // which indicates the very last page.\n      if (previousPage.data.length < WCA_API_PAGINATION) {\n        return undefined;\n      }\n      return allPages.length + 1;\n    },\n  });\n\n  const competitions = rawCompetitionData?.pages.flatMap((page) => page.data)\n    .filter((comp) => (\n      (!isCancelled(comp) || filterState.shouldIncludeCancelled)\n      && (filterState.selectedEvents.every((event) => comp.event_ids.includes(event)))\n    ));\n\n  return (\n    <Container>\n      <h2>{I18n.t('competitions.index.title')}</h2>\n      <CompetitionsFilters\n        filterState={filterState}\n        dispatchFilter={dispatchFilter}\n        displayMode={displayMode}\n        setDisplayMode={setDisplayMode}\n        shouldShowRegStatus={shouldShowRegStatus}\n        setShouldShowRegStatus={setShouldShowRegStatus}\n      />\n\n      <Container id=\"search-results\" className=\"row competitions-list\">\n        {\n          displayMode === 'list'\n          && (\n            <ListView\n              competitions={competitions}\n              filterState={filterState}\n              shouldShowRegStatus={shouldShowRegStatus}\n              isLoading={competitionsIsFetching}\n              fetchMoreCompetitions={competitionsFetchNextPage}\n              hasMoreCompsToLoad={hasMoreCompsToLoad}\n            />\n          )\n        }\n        {\n          displayMode === 'map'\n          && (\n            <MapView\n              competitions={\n                filterState.timeOrder === 'present'\n                  ? competitions?.filter((comp) => (\n                    !isInProgress(comp) && !isProbablyOver(comp)\n                  ))\n                  : competitions\n              }\n              fetchMoreCompetitions={competitionsFetchNextPage}\n              hasMoreCompsToLoad={hasMoreCompsToLoad}\n            />\n          )\n        }\n      </Container>\n    </Container>\n  );\n}\n\nexport default CompetitionsView;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}