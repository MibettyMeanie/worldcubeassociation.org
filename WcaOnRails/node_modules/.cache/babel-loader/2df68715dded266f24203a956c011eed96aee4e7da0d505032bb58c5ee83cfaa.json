{"ast":null,"code":"var _jsxFileName = \"/app/WcaOnRails/app/webpacker/components/EditSchedule/EditVenues/VenueLocationMap.js\";\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { MapContainer, Marker, Popup, TileLayer, useMap } from 'react-leaflet';\nimport { toDegrees, toMicrodegrees } from \"../../../lib/utils/edit-schedule\";\nimport { userTileProvider } from \"../../../lib/leaflet-wca/providers\";\nimport { useDispatch } from \"../../../lib/providers/StoreProvider\";\nimport { editVenue } from \"../store/actions\";\nimport ResizeMapIFrame from \"../../../lib/utils/leaflet-iframe\";\nfunction GeoSearchControl(_ref) {\n  var onGeoSearchResult = _ref.onGeoSearchResult;\n  var map = useMap();\n  useEffect(function () {\n    var searchControl = window.wca.createSearchInput(map);\n    map.on('geosearch/showlocation', onGeoSearchResult);\n    map.zoomControl.setPosition('bottomright');\n    return function () {\n      map.removeControl(searchControl);\n    };\n  }, [map, onGeoSearchResult]);\n  return null;\n}\nexport function DraggableMarker(_ref2) {\n  var position = _ref2.position,\n    setPosition = _ref2.setPosition,\n    _ref2$disabled = _ref2.disabled,\n    disabled = _ref2$disabled === void 0 ? false : _ref2$disabled,\n    _ref2$markerRef = _ref2.markerRef,\n    markerRef = _ref2$markerRef === void 0 ? null : _ref2$markerRef,\n    children = _ref2.children;\n  var updatePosition = useCallback(function (e) {\n    return setPosition(e, e.target.getLatLng());\n  }, [setPosition]);\n  return /*#__PURE__*/React.createElement(Marker, {\n    ref: markerRef,\n    position: position,\n    draggable: !disabled,\n    eventHandlers: {\n      dragend: updatePosition\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 5\n    }\n  }, children);\n}\nfunction VenueLocationMap(_ref3) {\n  var _this = this;\n  var venue = _ref3.venue;\n  var dispatch = useDispatch();\n  var markerRef = useRef();\n  var _useState = useState(),\n    _useState2 = _slicedToArray(_useState, 2),\n    searchResultPopup = _useState2[0],\n    setSearchResultPopup = _useState2[1];\n  var markerPopup = useMemo(function () {\n    if (searchResultPopup) {\n      return /*#__PURE__*/React.createElement(Popup, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 14\n        }\n      }, searchResultPopup);\n    }\n    return null;\n  }, [searchResultPopup]);\n  var mapPosition = useMemo(function () {\n    return {\n      lat: toDegrees(venue.latitudeMicrodegrees),\n      lng: toDegrees(venue.longitudeMicrodegrees)\n    };\n  }, [venue.latitudeMicrodegrees, venue.longitudeMicrodegrees]);\n  var setMapPosition = useCallback(function (evt, _ref4) {\n    var lat = _ref4.lat,\n      lng = _ref4.lng;\n    dispatch(editVenue(venue.id, 'latitudeMicrodegrees', toMicrodegrees(lat)));\n    dispatch(editVenue(venue.id, 'longitudeMicrodegrees', toMicrodegrees(lng)));\n  }, [dispatch, venue.id]);\n  var provider = userTileProvider;\n  var onGeoSearchResult = useCallback(function (evt) {\n    setMapPosition(evt, {\n      lat: evt.location.y,\n      lng: evt.location.x\n    });\n    setSearchResultPopup(evt.location.label);\n  }, [setMapPosition, setSearchResultPopup]);\n  return /*#__PURE__*/React.createElement(MapContainer, {\n    center: mapPosition,\n    zoom: 16,\n    scrollWheelZoom: false,\n    style: {\n      height: '100%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(ResizeMapIFrame, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(TileLayer, {\n    url: provider.url,\n    attribution: provider.attribution,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(GeoSearchControl, {\n    onGeoSearchResult: onGeoSearchResult,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(DraggableMarker, {\n    markerRef: markerRef,\n    position: mapPosition,\n    setPosition: setMapPosition,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }\n  }, markerPopup));\n}\nexport default VenueLocationMap;","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","MapContainer","Marker","Popup","TileLayer","useMap","toDegrees","toMicrodegrees","userTileProvider","useDispatch","editVenue","ResizeMapIFrame","GeoSearchControl","_ref","onGeoSearchResult","map","searchControl","window","wca","createSearchInput","on","zoomControl","setPosition","removeControl","DraggableMarker","_ref2","position","_ref2$disabled","disabled","_ref2$markerRef","markerRef","children","updatePosition","e","target","getLatLng","createElement","ref","draggable","eventHandlers","dragend","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","VenueLocationMap","_ref3","_this","venue","dispatch","_useState","_useState2","_slicedToArray","searchResultPopup","setSearchResultPopup","markerPopup","mapPosition","lat","latitudeMicrodegrees","lng","longitudeMicrodegrees","setMapPosition","evt","_ref4","id","provider","location","y","x","label","center","zoom","scrollWheelZoom","style","height","url","attribution"],"sources":["/app/WcaOnRails/app/webpacker/components/EditSchedule/EditVenues/VenueLocationMap.js"],"sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  MapContainer,\n  Marker,\n  Popup,\n  TileLayer,\n  useMap,\n} from 'react-leaflet';\nimport { toDegrees, toMicrodegrees } from '../../../lib/utils/edit-schedule';\nimport { userTileProvider } from '../../../lib/leaflet-wca/providers';\nimport { useDispatch } from '../../../lib/providers/StoreProvider';\nimport { editVenue } from '../store/actions';\nimport ResizeMapIFrame from '../../../lib/utils/leaflet-iframe';\n\nfunction GeoSearchControl({\n  onGeoSearchResult,\n}) {\n  const map = useMap();\n\n  useEffect(() => {\n    const searchControl = window.wca.createSearchInput(map);\n\n    map.on('geosearch/showlocation', onGeoSearchResult);\n    map.zoomControl.setPosition('bottomright');\n\n    return () => {\n      map.removeControl(searchControl);\n    };\n  }, [map, onGeoSearchResult]);\n\n  return null;\n}\n\nexport function DraggableMarker({\n  position,\n  setPosition,\n  disabled = false,\n  markerRef = null,\n  children,\n}) {\n  const updatePosition = useCallback((e) => setPosition(e, e.target.getLatLng()), [setPosition]);\n\n  return (\n    <Marker\n      ref={markerRef}\n      position={position}\n      draggable={!disabled}\n      eventHandlers={{\n        dragend: updatePosition,\n      }}\n    >\n      {children}\n    </Marker>\n  );\n}\n\nfunction VenueLocationMap({\n  venue,\n}) {\n  const dispatch = useDispatch();\n  const markerRef = useRef();\n\n  const [searchResultPopup, setSearchResultPopup] = useState();\n\n  const markerPopup = useMemo(() => {\n    if (searchResultPopup) {\n      return <Popup>{searchResultPopup}</Popup>;\n    }\n\n    return null;\n  }, [searchResultPopup]);\n\n  const mapPosition = useMemo(() => ({\n    lat: toDegrees(venue.latitudeMicrodegrees),\n    lng: toDegrees(venue.longitudeMicrodegrees),\n  }), [venue.latitudeMicrodegrees, venue.longitudeMicrodegrees]);\n\n  const setMapPosition = useCallback((evt, { lat, lng }) => {\n    dispatch(editVenue(venue.id, 'latitudeMicrodegrees', toMicrodegrees(lat)));\n    dispatch(editVenue(venue.id, 'longitudeMicrodegrees', toMicrodegrees(lng)));\n  }, [dispatch, venue.id]);\n\n  const provider = userTileProvider;\n\n  const onGeoSearchResult = useCallback((evt) => {\n    setMapPosition(evt, {\n      lat: evt.location.y,\n      lng: evt.location.x,\n    });\n\n    setSearchResultPopup(evt.location.label);\n  }, [setMapPosition, setSearchResultPopup]);\n\n  return (\n    <MapContainer\n      center={mapPosition}\n      zoom={16}\n      scrollWheelZoom={false}\n      style={{ height: '100%' }}\n    >\n      <ResizeMapIFrame />\n      <TileLayer url={provider.url} attribution={provider.attribution} />\n      <GeoSearchControl onGeoSearchResult={onGeoSearchResult} />\n      <DraggableMarker markerRef={markerRef} position={mapPosition} setPosition={setMapPosition}>\n        {markerPopup}\n      </DraggableMarker>\n    </MapContainer>\n  );\n}\n\nexport default VenueLocationMap;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}