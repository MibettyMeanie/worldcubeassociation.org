{"ast":null,"code":"import { useCallback } from 'react';\nimport { events } from \"../wca-data.js.erb\";\nimport I18n from \"../i18n\";\nimport { attemptResultToString, attemptResultToMbPoints } from \"./edit-events\";\nimport useSaveAction from \"../hooks/useSaveAction\";\nexport function useSaveWcifAction() {\n  var _useSaveAction = useSaveAction(),\n    save = _useSaveAction.save,\n    saving = _useSaveAction.saving;\n  var alertWcifError = function alertWcifError(err) {\n    /* eslint-disable-next-line */\n    alert(\"Something went wrong while saving.\\n\".concat(err.message));\n  };\n  var saveWcif = useCallback(function (competitionId, wcifData, onSuccess) {\n    var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    var onError = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : alertWcifError;\n    var url = \"/api/v0/competitions/\".concat(competitionId, \"/wcif\");\n    save(url, wcifData, onSuccess, options, onError);\n  }, [save]);\n  return {\n    saveWcif: saveWcif,\n    saving: saving\n  };\n}\n\n// Copied from https://github.com/jfly/tnoodle/blob/c2b529e6292469c23f33b1d73839e22f041443e0/tnoodle-ui/src/WcaCompetitionJson.js#L52\nexport function parseActivityCode(activityCode) {\n  var roundNumber;\n  var group;\n  var attempt;\n  var parts = activityCode.split('-');\n  var eventId = parts.shift();\n  parts.forEach(function (part) {\n    var firstLetter = part[0];\n    var rest = part.substring(1);\n    if (firstLetter === 'r') {\n      roundNumber = parseInt(rest, 10);\n    } else if (firstLetter === 'g') {\n      group = rest;\n    } else if (firstLetter === 'a') {\n      attempt = rest;\n    } else {\n      throw new Error(\"Unrecognized activity code part: \".concat(part, \" of \").concat(activityCode));\n    }\n  });\n  return {\n    eventId: eventId,\n    roundNumber: roundNumber,\n    group: group,\n    attempt: attempt\n  };\n}\nexport function roundIdToString(roundId) {\n  var _parseActivityCode = parseActivityCode(roundId),\n    eventId = _parseActivityCode.eventId,\n    roundNumber = _parseActivityCode.roundNumber;\n  var event = events.byId[eventId];\n  return \"\".concat(event.name, \", Round \").concat(roundNumber);\n}\nexport function buildActivityCode(activity) {\n  var activityCode = activity.eventId;\n  if (activity.roundNumber) {\n    activityCode += \"-r\".concat(activity.roundNumber);\n  }\n  if (activity.group) {\n    activityCode += \"-g\".concat(activity.group);\n  }\n  return activityCode;\n}\nexport function roomWcifFromId(scheduleWcif, id) {\n  var intId = parseInt(id, 10);\n  return scheduleWcif.venues.flatMap(function (venue) {\n    return venue.rooms;\n  }).find(function (room) {\n    return room.id === intId;\n  });\n}\nexport function venueWcifFromRoomId(scheduleWcif, id) {\n  var intId = parseInt(id, 10);\n  return scheduleWcif.venues.find(function (venue) {\n    return venue.rooms.some(function (room) {\n      return room.id === intId;\n    });\n  });\n}\nexport function eventQualificationToString(wcifEvent, qualification) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _short = _ref[\"short\"];\n  if (!qualification) {\n    return '-';\n  }\n  var dateString = '-';\n  if (qualification.whenDate) {\n    var whenDate = window.moment(qualification.whenDate).toDate();\n    dateString = whenDate.toISOString().substring(0, 10);\n  }\n  var deadlineString = I18n.t('qualification.deadline.by_date', {\n    date: dateString\n  });\n  var event = events.byId[wcifEvent.id];\n  switch (qualification.resultType) {\n    case 'single':\n    case 'average':\n      if (qualification.type === 'ranking') {\n        var messageName = \"qualification.\".concat(qualification.resultType, \".ranking\");\n        return \"\".concat(I18n.t(messageName, {\n          ranking: qualification.level\n        }), \" \").concat(deadlineString);\n      }\n      if (qualification.type === 'anyResult') {\n        var _messageName = \"qualification.\".concat(qualification.resultType, \".any_result\");\n        return \"\".concat(I18n.t(_messageName), \" \").concat(deadlineString);\n      }\n      if (event.isTimedEvent) {\n        var _messageName2 = \"qualification.\".concat(qualification.resultType, \".time\");\n        return \"\".concat(I18n.t(_messageName2, {\n          time: attemptResultToString(qualification.level, wcifEvent.id, _short)\n        }), \" \").concat(deadlineString);\n      }\n      if (event.isFewestMoves) {\n        var _messageName3 = \"qualification.\".concat(qualification.resultType, \".moves\");\n        var moves = qualification.resultType === 'average' ? qualification.level / 100 : qualification.level;\n        return \"\".concat(I18n.t(_messageName3, {\n          moves: moves\n        }), \" \").concat(deadlineString);\n      }\n      if (event.isMultipleBlindfolded) {\n        var _messageName4 = \"qualification.\".concat(qualification.resultType, \".points\");\n        return \"\".concat(I18n.t(_messageName4, {\n          points: attemptResultToMbPoints(qualification.level)\n        }), \" \").concat(deadlineString);\n      }\n      return '-';\n    default:\n      return '-';\n  }\n}","map":{"version":3,"names":["useCallback","events","I18n","attemptResultToString","attemptResultToMbPoints","useSaveAction","useSaveWcifAction","_useSaveAction","save","saving","alertWcifError","err","alert","concat","message","saveWcif","competitionId","wcifData","onSuccess","options","arguments","length","undefined","onError","url","parseActivityCode","activityCode","roundNumber","group","attempt","parts","split","eventId","shift","forEach","part","firstLetter","rest","substring","parseInt","Error","roundIdToString","roundId","_parseActivityCode","event","byId","name","buildActivityCode","activity","roomWcifFromId","scheduleWcif","id","intId","venues","flatMap","venue","rooms","find","room","venueWcifFromRoomId","some","eventQualificationToString","wcifEvent","qualification","_ref","short","dateString","whenDate","window","moment","toDate","toISOString","deadlineString","t","date","resultType","type","messageName","ranking","level","isTimedEvent","time","isFewestMoves","moves","isMultipleBlindfolded","points"],"sources":["/app/WcaOnRails/app/webpacker/lib/utils/wcif.js"],"sourcesContent":["import { useCallback } from 'react';\nimport { events } from '../wca-data.js.erb';\nimport I18n from '../i18n';\nimport { attemptResultToString, attemptResultToMbPoints } from './edit-events';\nimport useSaveAction from '../hooks/useSaveAction';\n\nexport function useSaveWcifAction() {\n  const { save, saving } = useSaveAction();\n\n  const alertWcifError = (err) => {\n    /* eslint-disable-next-line */\n    alert(`Something went wrong while saving.\\n${err.message}`);\n  };\n\n  const saveWcif = useCallback(\n    (\n      competitionId,\n      wcifData,\n      onSuccess,\n      options = {},\n      onError = alertWcifError,\n    ) => {\n      const url = `/api/v0/competitions/${competitionId}/wcif`;\n\n      save(url, wcifData, onSuccess, options, onError);\n    },\n    [save],\n  );\n\n  return {\n    saveWcif,\n    saving,\n  };\n}\n\n// Copied from https://github.com/jfly/tnoodle/blob/c2b529e6292469c23f33b1d73839e22f041443e0/tnoodle-ui/src/WcaCompetitionJson.js#L52\nexport function parseActivityCode(activityCode) {\n  let roundNumber; let group; let\n    attempt;\n  const parts = activityCode.split('-');\n  const eventId = parts.shift();\n\n  parts.forEach((part) => {\n    const firstLetter = part[0];\n    const rest = part.substring(1);\n    if (firstLetter === 'r') {\n      roundNumber = parseInt(rest, 10);\n    } else if (firstLetter === 'g') {\n      group = rest;\n    } else if (firstLetter === 'a') {\n      attempt = rest;\n    } else {\n      throw new Error(`Unrecognized activity code part: ${part} of ${activityCode}`);\n    }\n  });\n  return {\n    eventId, roundNumber, group, attempt,\n  };\n}\n\nexport function roundIdToString(roundId) {\n  const { eventId, roundNumber } = parseActivityCode(roundId);\n  const event = events.byId[eventId];\n  return `${event.name}, Round ${roundNumber}`;\n}\n\nexport function buildActivityCode(activity) {\n  let activityCode = activity.eventId;\n  if (activity.roundNumber) {\n    activityCode += `-r${activity.roundNumber}`;\n  }\n  if (activity.group) {\n    activityCode += `-g${activity.group}`;\n  }\n\n  return activityCode;\n}\n\nexport function roomWcifFromId(scheduleWcif, id) {\n  const intId = parseInt(id, 10);\n  return scheduleWcif.venues.flatMap((venue) => venue.rooms).find((room) => room.id === intId);\n}\n\nexport function venueWcifFromRoomId(scheduleWcif, id) {\n  const intId = parseInt(id, 10);\n  return scheduleWcif.venues.find((venue) => venue.rooms.some((room) => room.id === intId));\n}\n\nexport function eventQualificationToString(wcifEvent, qualification, { short } = {}) {\n  if (!qualification) {\n    return '-';\n  }\n  let dateString = '-';\n  if (qualification.whenDate) {\n    const whenDate = window.moment(qualification.whenDate).toDate();\n    dateString = whenDate.toISOString().substring(0, 10);\n  }\n  const deadlineString = I18n.t('qualification.deadline.by_date', { date: dateString });\n  const event = events.byId[wcifEvent.id];\n  switch (qualification.resultType) {\n    case 'single':\n    case 'average':\n      if (qualification.type === 'ranking') {\n        const messageName = `qualification.${qualification.resultType}.ranking`;\n        return `${I18n.t(messageName, { ranking: qualification.level })} ${deadlineString}`;\n      }\n      if (qualification.type === 'anyResult') {\n        const messageName = `qualification.${qualification.resultType}.any_result`;\n        return `${I18n.t(messageName)} ${deadlineString}`;\n      }\n      if (event.isTimedEvent) {\n        const messageName = `qualification.${qualification.resultType}.time`;\n        return `${I18n.t(messageName, { time: attemptResultToString(qualification.level, wcifEvent.id, short) })} ${deadlineString}`;\n      }\n      if (event.isFewestMoves) {\n        const messageName = `qualification.${qualification.resultType}.moves`;\n        const moves = qualification.resultType === 'average' ? qualification.level / 100 : qualification.level;\n        return `${I18n.t(messageName, { moves })} ${deadlineString}`;\n      }\n      if (event.isMultipleBlindfolded) {\n        const messageName = `qualification.${qualification.resultType}.points`;\n        return `${I18n.t(messageName, { points: attemptResultToMbPoints(qualification.level) })} ${deadlineString}`;\n      }\n      return '-';\n    default:\n      return '-';\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}