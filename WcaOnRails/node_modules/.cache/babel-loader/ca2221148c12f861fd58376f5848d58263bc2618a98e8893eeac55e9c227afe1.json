{"ast":null,"code":"import { DateTime } from 'luxon';\nimport { competitionConstants } from \"../../lib/wca-data.js.erb\";\nvar isContinent = function isContinent(region) {\n  return region[0] === '_';\n};\nexport function calculateQueryKey(filterState) {\n  var timeKey = '';\n  if ((filterState === null || filterState === void 0 ? void 0 : filterState.timeOrder) === 'past') {\n    timeKey = \"\".concat(filterState.selectedYear);\n  } else if ((filterState === null || filterState === void 0 ? void 0 : filterState.timeOrder) === 'custom') {\n    timeKey = \"start\".concat(filterState.customStartDate, \"-end\").concat(filterState.customEndDate);\n  }\n  return {\n    timeOrder: filterState === null || filterState === void 0 ? void 0 : filterState.timeOrder,\n    region: filterState === null || filterState === void 0 ? void 0 : filterState.region,\n    delegate: filterState === null || filterState === void 0 ? void 0 : filterState.delegate,\n    search: filterState === null || filterState === void 0 ? void 0 : filterState.search,\n    time: timeKey\n  };\n}\nexport function createSearchParams(filterState, pageParam) {\n  var region = filterState.region,\n    delegate = filterState.delegate,\n    search = filterState.search,\n    timeOrder = filterState.timeOrder,\n    selectedYear = filterState.selectedYear,\n    customStartDate = filterState.customStartDate,\n    customEndDate = filterState.customEndDate;\n  var dateNow = DateTime.now();\n  var searchParams = new URLSearchParams({});\n  if (region && region !== 'all_regions') {\n    var regionParam = isContinent(region) ? 'continent' : 'country_iso2';\n    searchParams.append(regionParam, region);\n  }\n  if (delegate) {\n    searchParams.append('delegate', delegate);\n  }\n  if (search) {\n    searchParams.append('q', search);\n  }\n  if (timeOrder === 'present') {\n    searchParams.append('sort', 'start_date,end_date,name');\n    searchParams.append('ongoing_and_future', dateNow.toFormat('yyyy-MM-dd'));\n    searchParams.append('page', pageParam);\n  } else if (timeOrder === 'recent') {\n    // noinspection JSAnnotator\n    var recentDaysAgo = dateNow.minus({\n      days: competitionConstants.competitionRecentDays\n    });\n    searchParams.append('sort', '-end_date,-start_date,name');\n    searchParams.append('start', recentDaysAgo.toFormat('yyyy-MM-dd'));\n    searchParams.append('end', dateNow.toFormat('yyyy-MM-dd'));\n    searchParams.append('page', pageParam);\n  } else if (timeOrder === 'past') {\n    if (selectedYear === 'all_years') {\n      searchParams.append('sort', '-end_date,-start_date,name');\n      searchParams.append('end', dateNow.toFormat('yyyy-MM-dd'));\n      searchParams.append('page', pageParam);\n    } else {\n      searchParams.append('sort', '-end_date,-start_date,name');\n      searchParams.append('start', \"\".concat(selectedYear, \"-1-1\"));\n      searchParams.append('end', dateNow.year === selectedYear ? dateNow.toFormat('yyyy-MM-dd') : \"\".concat(selectedYear, \"-12-31\"));\n      searchParams.append('page', pageParam);\n    }\n  } else if (timeOrder === 'by_announcement') {\n    searchParams.append('sort', '-announced_at,name');\n    searchParams.append('page', pageParam);\n  } else if (timeOrder === 'custom') {\n    var startLuxon = DateTime.fromJSDate(customStartDate);\n    var endLuxon = DateTime.fromJSDate(customEndDate);\n    searchParams.append('sort', 'start_date,end_date,name');\n    searchParams.append('start', startLuxon.isValid ? startLuxon.toFormat('yyyy-MM-dd') : '');\n    searchParams.append('end', endLuxon.isValid ? endLuxon.toFormat('yyyy-MM-dd') : '');\n    searchParams.append('page', pageParam);\n  }\n  return searchParams;\n}","map":{"version":3,"names":["DateTime","competitionConstants","isContinent","region","calculateQueryKey","filterState","timeKey","timeOrder","concat","selectedYear","customStartDate","customEndDate","delegate","search","time","createSearchParams","pageParam","dateNow","now","searchParams","URLSearchParams","regionParam","append","toFormat","recentDaysAgo","minus","days","competitionRecentDays","year","startLuxon","fromJSDate","endLuxon","isValid"],"sources":["/app/WcaOnRails/app/webpacker/components/CompetitionsOverview/queryUtils.js"],"sourcesContent":["import { DateTime } from 'luxon';\n\nimport { competitionConstants } from '../../lib/wca-data.js.erb';\n\nconst isContinent = (region) => region[0] === '_';\n\nexport function calculateQueryKey(filterState) {\n  let timeKey = '';\n  if (filterState?.timeOrder === 'past') {\n    timeKey = `${filterState.selectedYear}`;\n  } else if (filterState?.timeOrder === 'custom') {\n    timeKey = `start${filterState.customStartDate}-end${filterState.customEndDate}`;\n  }\n\n  return {\n    timeOrder: filterState?.timeOrder,\n    region: filterState?.region,\n    delegate: filterState?.delegate,\n    search: filterState?.search,\n    time: timeKey,\n  };\n}\n\nexport function createSearchParams(filterState, pageParam) {\n  const {\n    region, delegate, search, timeOrder, selectedYear, customStartDate, customEndDate,\n  } = filterState;\n\n  const dateNow = DateTime.now();\n  const searchParams = new URLSearchParams({});\n\n  if (region && region !== 'all_regions') {\n    const regionParam = isContinent(region) ? 'continent' : 'country_iso2';\n    searchParams.append(regionParam, region);\n  }\n  if (delegate) {\n    searchParams.append('delegate', delegate);\n  }\n  if (search) {\n    searchParams.append('q', search);\n  }\n\n  if (timeOrder === 'present') {\n    searchParams.append('sort', 'start_date,end_date,name');\n    searchParams.append('ongoing_and_future', dateNow.toFormat('yyyy-MM-dd'));\n    searchParams.append('page', pageParam);\n  } else if (timeOrder === 'recent') {\n    // noinspection JSAnnotator\n    const recentDaysAgo = dateNow.minus({ days: competitionConstants.competitionRecentDays });\n\n    searchParams.append('sort', '-end_date,-start_date,name');\n    searchParams.append('start', recentDaysAgo.toFormat('yyyy-MM-dd'));\n    searchParams.append('end', dateNow.toFormat('yyyy-MM-dd'));\n    searchParams.append('page', pageParam);\n  } else if (timeOrder === 'past') {\n    if (selectedYear === 'all_years') {\n      searchParams.append('sort', '-end_date,-start_date,name');\n      searchParams.append('end', dateNow.toFormat('yyyy-MM-dd'));\n      searchParams.append('page', pageParam);\n    } else {\n      searchParams.append('sort', '-end_date,-start_date,name');\n      searchParams.append('start', `${selectedYear}-1-1`);\n      searchParams.append('end', dateNow.year === selectedYear ? dateNow.toFormat('yyyy-MM-dd') : `${selectedYear}-12-31`);\n      searchParams.append('page', pageParam);\n    }\n  } else if (timeOrder === 'by_announcement') {\n    searchParams.append('sort', '-announced_at,name');\n    searchParams.append('page', pageParam);\n  } else if (timeOrder === 'custom') {\n    const startLuxon = DateTime.fromJSDate(customStartDate);\n    const endLuxon = DateTime.fromJSDate(customEndDate);\n\n    searchParams.append('sort', 'start_date,end_date,name');\n    searchParams.append('start', startLuxon.isValid ? startLuxon.toFormat('yyyy-MM-dd') : '');\n    searchParams.append('end', endLuxon.isValid ? endLuxon.toFormat('yyyy-MM-dd') : '');\n    searchParams.append('page', pageParam);\n  }\n\n  return searchParams;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}